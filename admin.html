<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Radix — Admin Portal</title>

    <script>
      (function () {
        try {
          const raw = localStorage.getItem('radix_state');
          const theme = raw ? (JSON.parse(raw)?.ui?.theme || 'light') : 'light';
          if (theme === 'dark') document.documentElement.classList.add('dark');
        } catch {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: 'class' };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      :root {
        --sidebar-width: 170px;
        --sidebar-collapsed: 44px;
        --brand-font: 'Merriweather', serif;
        --body-font: 'Inter', sans-serif;
      }

      body {
        font-family: var(--body-font);
        font-size: 12px;
      }

      /* ===== COMPACT GLOBAL OVERRIDES ===== */
      h1, h2, h3, h4, h5, h6 { letter-spacing: -0.01em; }
      .text-base { font-size: 0.8rem !important; line-height: 1.15rem !important; }
      .text-sm { font-size: 0.7rem !important; line-height: 1rem !important; }
      .text-xs { font-size: 0.65rem !important; line-height: 0.9rem !important; }
      .text-lg { font-size: 0.9rem !important; line-height: 1.2rem !important; }
      .text-xl { font-size: 1rem !important; line-height: 1.3rem !important; }
      .text-2xl { font-size: 1.15rem !important; line-height: 1.4rem !important; }
      .text-\[9px\] { font-size: 7px !important; }
      .text-\[10px\] { font-size: 8px !important; }
      .text-\[11px\] { font-size: 9px !important; }
      .p-4 { padding: 0.6rem !important; }
      .p-3 { padding: 0.45rem !important; }
      .p-5 { padding: 0.75rem !important; }
      .p-6 { padding: 0.85rem !important; }
      .px-4 { padding-left: 0.6rem !important; padding-right: 0.6rem !important; }
      .px-3 { padding-left: 0.45rem !important; padding-right: 0.45rem !important; }
      .py-2 { padding-top: 0.3rem !important; padding-bottom: 0.3rem !important; }
      .py-1\.5 { padding-top: 0.2rem !important; padding-bottom: 0.2rem !important; }
      .py-1 { padding-top: 0.15rem !important; padding-bottom: 0.15rem !important; }
      .gap-4 { gap: 0.6rem !important; }
      .gap-3 { gap: 0.45rem !important; }
      .gap-2 { gap: 0.3rem !important; }
      .space-y-1\.5 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.2rem !important; }
      .space-y-3 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.4rem !important; }
      .mb-4 { margin-bottom: 0.6rem !important; }
      .mb-3 { margin-bottom: 0.45rem !important; }
      .mb-2 { margin-bottom: 0.3rem !important; }
      .mb-1 { margin-bottom: 0.15rem !important; }
      .w-9 { width: 1.75rem !important; }
      .h-9 { height: 1.75rem !important; }
      .w-8 { width: 1.5rem !important; }
      .h-8 { height: 1.5rem !important; }
      .w-7 { width: 1.35rem !important; }
      .h-7 { height: 1.35rem !important; }
      .w-10 { width: 2rem !important; }
      .h-10 { height: 2rem !important; }
      .w-5 { width: 1rem !important; }
      .h-5 { height: 1rem !important; }
      .w-4 { width: 0.85rem !important; }
      .h-4 { height: 0.85rem !important; }
      .w-3\.5 { width: 0.7rem !important; }
      .h-3\.5 { height: 0.7rem !important; }
      .w-3 { width: 0.6rem !important; }
      .h-3 { height: 0.6rem !important; }
      .rounded-xl { border-radius: 0.6rem !important; }
      .rounded-lg { border-radius: 0.4rem !important; }
      .h-12 { height: 2.5rem !important; }
      header .h-12, .sidebar .h-12 { height: 2.5rem !important; }
      .dashboard-card { padding: 0.6rem !important; }
      .max-w-sm { max-width: 20rem !important; }
      .max-w-md { max-width: 24rem !important; }

      .brand-font {
        font-family: var(--brand-font);
      }

      /* Sidebar hover expand/collapse */
      .sidebar {
        width: var(--sidebar-collapsed);
        transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
      }

      .sidebar:hover,
      .sidebar.expanded {
        width: var(--sidebar-width);
      }

      /* Main content offset */
      .main-content {
        margin-left: var(--sidebar-collapsed);
        padding-left: 8px;
        transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .sidebar:hover ~ .main-content,
      .sidebar.expanded ~ .main-content {
        margin-left: var(--sidebar-width);
      }

      /* Menu item animations */
      .menu-item {
        position: relative;
        overflow: hidden;
      }

      .menu-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 3px;
        background: linear-gradient(180deg, #14b8a6, #06b6d4);
        transform: scaleY(0);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .menu-item:hover::before,
      .menu-item.active::before {
        transform: scaleY(1);
      }

      .menu-item:hover,
      .menu-item.active {
        background: rgba(20, 184, 166, 0.1);
      }

      /* Icon bounce on hover */
      .menu-item:hover .menu-icon {
        animation: iconBounce 0.4s ease;
      }

      @keyframes iconBounce {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
      }

      /* Sidebar collapsed text - fully removed from layout when collapsed */
      .sidebar .menu-text {
        opacity: 0;
        width: 0;
        overflow: hidden;
        transform: translateX(-10px);
        transition: opacity 0.25s ease, transform 0.25s ease, width 0.25s ease;
        pointer-events: none;
        white-space: nowrap;
      }

      .sidebar:hover .menu-text,
      .sidebar.expanded .menu-text {
        opacity: 1;
        width: auto;
        transform: translateX(0);
        pointer-events: auto;
      }

      /* Logo text */
      .logo-text {
        opacity: 0;
        width: 0;
        overflow: hidden;
        transform: scale(0.8);
        transition: opacity 0.25s ease, transform 0.25s ease, width 0.25s ease;
      }

      .sidebar:hover .logo-text,
      .sidebar.expanded .logo-text {
        opacity: 1;
        width: auto;
        transform: scale(1);
      }

      /* Sidebar menu items - centered when collapsed */
      .sidebar .menu-item {
        justify-content: center;
        padding-left: 0;
        padding-right: 0;
        transition: all 0.25s ease;
      }

      .sidebar:hover .menu-item,
      .sidebar.expanded .menu-item {
        justify-content: flex-start;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }

      /* Card hover effects */
      .dashboard-card, .hover-card {
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
      }

      .dashboard-card:hover, .hover-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.25);
      }

      /* Menu item hover */
      .menu-item {
        transition: all 0.2s ease;
      }

      .menu-item:hover {
        transform: translateX(3px);
        background-color: rgba(20, 184, 166, 0.1);
        border-color: rgba(20, 184, 166, 0.3) !important;
      }

      .menu-item.active {
        background-color: rgba(20, 184, 166, 0.15);
        border-color: rgba(20, 184, 166, 0.4) !important;
      }

      /* Admin-only items are always visible on admin portal */

      /* Calendar Date Range Picker */
      .date-range-picker {
        position: relative;
      }

      .date-picker-dropdown {
        min-width: 580px;
      }

      .calendar-month {
        min-width: 250px;
      }

      .calendar-day {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.15s ease;
        color: #334155;
      }

      .dark .calendar-day {
        color: #e2e8f0;
      }

      .calendar-day:hover:not(.disabled):not(.selected):not(.in-range) {
        background-color: rgba(20, 184, 166, 0.3);
      }

      .calendar-day.other-month {
        color: #94a3b8;
      }

      .dark .calendar-day.other-month {
        color: #475569;
      }

      .calendar-day.disabled {
        color: #cbd5e1;
        cursor: default;
      }

      .calendar-day.today {
        border: 1px solid #14b8a6;
      }

      .calendar-day.selected {
        background-color: #14b8a6;
        color: white;
      }

      .calendar-day.in-range {
        background-color: rgba(20, 184, 166, 0.2);
        border-radius: 0;
      }

      .calendar-day.range-start {
        border-radius: 50% 0 0 50%;
        background-color: #14b8a6;
        color: white;
      }

      .calendar-day.range-end {
        border-radius: 0 50% 50% 0;
        background-color: #14b8a6;
        color: white;
      }

      .calendar-day.range-start.range-end {
        border-radius: 50%;
      }

      /* Hide pages properly */
      .page-content.hidden {
        display: none !important;
      }

      /* Page transition */
      .page-content {
        animation: pageIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      @keyframes pageIn {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Gradient text */
      .gradient-text {
        background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 50%, #22d3ee 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Glow effect */
      .glow {
        box-shadow: 0 0 20px rgba(20, 184, 166, 0.3);
      }

      /* Subtle pulse */
      @keyframes subtlePulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }

      .pulse-subtle {
        animation: subtlePulse 2s ease-in-out infinite;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 6px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(20, 184, 166, 0.3);
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(20, 184, 166, 0.5);
      }

      /* Toast Notifications */
      .toast-container {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 8px;
        pointer-events: none;
      }
      .toast {
        pointer-events: all;
        display: flex;
        align-items: center;
        gap: 7px;
        padding: 7px 12px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 500;
        box-shadow: 0 6px 24px rgba(0,0,0,0.25);
        animation: toastIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        max-width: 320px;
        backdrop-filter: blur(12px);
      }
      .toast.toast-exit {
        animation: toastOut 0.3s ease-in forwards;
      }
      .toast-success {
        background: linear-gradient(135deg, rgba(16,185,129,0.95), rgba(5,150,105,0.95));
        color: white;
        border: 1px solid rgba(255,255,255,0.15);
      }
      .toast-error {
        background: linear-gradient(135deg, rgba(239,68,68,0.95), rgba(220,38,38,0.95));
        color: white;
        border: 1px solid rgba(255,255,255,0.15);
      }
      .toast-warning {
        background: linear-gradient(135deg, rgba(245,158,11,0.95), rgba(217,119,6,0.95));
        color: white;
        border: 1px solid rgba(255,255,255,0.15);
      }
      .toast-info {
        background: linear-gradient(135deg, rgba(20,184,166,0.95), rgba(13,148,136,0.95));
        color: white;
        border: 1px solid rgba(255,255,255,0.15);
      }
      @keyframes toastIn {
        0% { opacity: 0; transform: translateX(80px) scale(0.9); }
        100% { opacity: 1; transform: translateX(0) scale(1); }
      }
      @keyframes toastOut {
        0% { opacity: 1; transform: translateX(0) scale(1); }
        100% { opacity: 0; transform: translateX(80px) scale(0.9); }
      }

      /* Offer mini calendar */
      .offer-cal-day {
        width: 24px; height: 24px;
        display: flex; align-items: center; justify-content: center;
        border-radius: 50%;
        cursor: pointer;
        font-size: 10px;
        color: #334155;
        transition: all 0.15s;
      }
      .offer-cal-day:hover { background: rgba(20,184,166,0.3); }
      .offer-cal-day.selected { background: #14b8a6; color: white; font-weight: 600; }
      .offer-cal-day.today { border: 1px solid #14b8a6; }
      .offer-cal-day.other { color: #475569; cursor: default; }
      .offer-cal-day.other:hover { background: transparent; }
    </style>
  </head>

  <body class="h-full bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 overflow-hidden">
    
    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Custom Confirm Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[9998]">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-sm mx-4 p-5 shadow-xl border border-slate-200 dark:border-slate-700">
        <div class="flex items-start gap-3 mb-4">
          <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
          </div>
          <div>
            <h3 id="confirmTitle" class="text-sm font-bold text-slate-900 dark:text-white">Confirm Action</h3>
            <p id="confirmMessage" class="text-xs text-slate-500 dark:text-slate-400 mt-1">Are you sure you want to proceed?</p>
          </div>
        </div>
        <div class="flex justify-end gap-2">
          <button id="confirmCancel" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button id="confirmOk" class="px-3 py-1.5 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors">Delete</button>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed left-0 top-0 h-full bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 z-50 flex flex-col">
      
      <!-- Logo Section -->
      <div class="h-12 flex items-center px-3 border-b border-slate-200 dark:border-slate-800">
        <div class="flex items-center gap-2 overflow-hidden">
          <div class="w-7 h-7 rounded-lg bg-gradient-to-br from-teal-500 to-cyan-600 flex items-center justify-center flex-shrink-0 glow">
            <span class="text-white font-bold text-sm brand-font">R</span>
          </div>
          <div class="logo-text">
            <h1 class="text-base font-bold brand-font gradient-text">Radix</h1>
            <p class="text-[9px] text-slate-500 dark:text-slate-400 -mt-0.5 italic">The Root of Reliability</p>
          </div>
        </div>
      </div>

      <!-- Main Navigation -->
      <nav class="flex-1 py-2 px-1.5 overflow-y-auto">
        <ul class="space-y-1.5">
          <li>
            <a href="#dashboard" class="menu-item active flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="dashboard">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
              </svg>
              <span class="menu-text font-medium">Dashboard</span>
            </a>
          </li>
          <li>
            <a href="#invoicing" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="invoicing">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
              </svg>
              <span class="menu-text font-medium">Invoicing & Payment</span>
            </a>
          </li>
          <li>
            <a href="#customers" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="customers">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
              </svg>
              <span class="menu-text font-medium">My Customers</span>
            </a>
          </li>
          <li>
            <a href="#tickets" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="tickets">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/>
              </svg>
              <span class="menu-text font-medium">Tickets</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Bottom Navigation -->
      <div class="border-t border-slate-200 dark:border-slate-800 py-2 px-1.5">
        <ul class="space-y-1.5">
          <li>
            <a href="#activity" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="activity">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span class="menu-text font-medium">Activity Logs</span>
            </a>
          </li>
          <li>
            <a href="#plan-mgmt" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="plan-mgmt">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
              </svg>
              <span class="menu-text font-medium">Plan Mgmt</span>
            </a>
          </li>
          <li>
            <a href="#customer-mgmt" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="customer-mgmt">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
              </svg>
              <span class="menu-text font-medium">Customer Mgmt</span>
            </a>
          </li>
          <li>
            <a href="#user-mgmt" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="user-mgmt">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
              </svg>
              <span class="menu-text font-medium">User Mgmt</span>
            </a>
          </li>
          <li>
            <a href="#settings" class="menu-item flex items-center gap-2 px-2 py-1.5 rounded-md text-sm text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white border border-slate-200 dark:border-slate-700" data-page="settings">
              <svg class="menu-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <span class="menu-text font-medium">Settings</span>
            </a>
          </li>
        </ul>
      </div>

    </aside>

    <!-- Main Content -->
    <main id="mainContent" class="main-content h-full overflow-y-auto">
      
      <!-- Top Bar -->
      <header class="sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800">
        <div class="flex items-center justify-between h-12 px-4">
          <div>
            <h2 id="pageTitle" class="text-base font-semibold">Dashboard</h2>
            <p class="text-xs text-slate-500 dark:text-slate-400">Welcome back, <span id="userName" class="font-medium text-teal-600 dark:text-teal-400">Ravikiran</span></p>
          </div>
          <div class="flex items-center gap-3">
            <!-- Theme Toggle -->
            <button id="themeToggle" class="p-1.5 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
              <svg class="w-4 h-4 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
              </svg>
              <svg class="w-4 h-4 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
              </svg>
            </button>
            <!-- Logout -->
            <button id="logoutBtn" class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
              </svg>
              Logout
            </button>
          </div>
        </div>
      </header>

      <!-- Page Content Container -->
      <div id="pageContent" class="p-4">
        <!-- Dashboard Page (default) -->
        <div id="page-dashboard" class="page-content">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
            <!-- Stats Cards -->
            <div class="dashboard-card bg-white dark:bg-slate-900 rounded-xl p-4 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between mb-2">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-green-500">Active</span>
              </div>
              <h3 class="text-xl font-bold mb-0.5" id="dashCustomerCount">0</h3>
              <p class="text-xs text-slate-500 dark:text-slate-400">Total Customers</p>
            </div>

            <div class="dashboard-card bg-white dark:bg-slate-900 rounded-xl p-4 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between mb-2">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-green-500">Collected</span>
              </div>
              <h3 class="text-xl font-bold mb-0.5" id="dashRevenue">₹0</h3>
              <p class="text-xs text-slate-500 dark:text-slate-400">Revenue</p>
            </div>

            <div class="dashboard-card bg-white dark:bg-slate-900 rounded-xl p-4 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between mb-2">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-amber-500" id="dashPendingBadge">0 pending</span>
              </div>
              <h3 class="text-xl font-bold mb-0.5" id="dashInvoiceCount">0</h3>
              <p class="text-xs text-slate-500 dark:text-slate-400">Total Invoices</p>
            </div>

            <div class="dashboard-card bg-white dark:bg-slate-900 rounded-xl p-4 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between mb-2">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-red-500" id="dashOverdueBadge">0 overdue</span>
              </div>
              <h3 class="text-xl font-bold mb-0.5" id="dashOutstanding">₹0</h3>
              <p class="text-xs text-slate-500 dark:text-slate-400">Outstanding</p>
            </div>
          </div>

          <!-- Date Range Filter -->
          <div class="date-range-picker mb-4" id="dashboardDatePicker">
            <button onclick="toggleDatePicker('dashboard', event)" class="date-range-trigger flex items-center gap-2 px-3 py-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-white rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-700 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <span id="dashboardDateDisplay" class="text-sm">Select Date Range</span>
            </button>
            <div id="dashboardCalendar" class="date-picker-dropdown hidden absolute z-50 mt-2 p-4 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl">
              <div class="flex gap-6">
                <!-- Left Month -->
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <button onclick="prevMonth('dashboard', 0)" class="p-1 hover:bg-slate-700 rounded">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                    </button>
                    <span id="dashboardMonth0" class="text-sm font-medium">February 2026</span>
                    <div class="w-6"></div>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2">
                    <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                  </div>
                  <div id="dashboardDays0" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
                <!-- Right Month -->
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <div class="w-6"></div>
                    <span id="dashboardMonth1" class="text-sm font-medium">March 2026</span>
                    <button onclick="nextMonth('dashboard', 1)" class="p-1 hover:bg-slate-700 rounded">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </button>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2">
                    <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                  </div>
                  <div id="dashboardDays1" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
              </div>
              <div class="flex justify-end gap-2 mt-4 pt-3 border-t border-slate-700">
                <button onclick="clearDateRange('dashboard')" class="px-3 py-1.5 text-xs text-slate-400 hover:text-white transition-colors">Clear</button>
                <button onclick="applyDateRange('dashboard')" class="px-3 py-1.5 text-xs bg-teal-600 text-white rounded hover:bg-teal-700 transition-colors">Apply</button>
              </div>
            </div>
          </div>

          <!-- Dashboard Charts & Insights -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
            <!-- Revenue Trend Chart -->
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-semibold text-slate-900 dark:text-white">Revenue Trend</h3>
                <span class="text-[10px] px-2 py-0.5 bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 rounded-full">Last 6 months</span>
              </div>
              <div id="revenueChart" class="h-48 flex items-end gap-2 px-2">
                <!-- Chart bars rendered by JS -->
              </div>
              <div id="revenueChartLabels" class="flex gap-2 px-2 mt-2">
                <!-- Labels rendered by JS -->
              </div>
            </div>

            <!-- Invoicing Status Breakdown -->
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-semibold text-slate-900 dark:text-white">Invoicing Overview</h3>
              </div>
              <div id="invoicingDonutChart" class="flex items-center justify-center gap-6">
                <!-- Donut chart -->
                <div class="relative w-36 h-36">
                  <svg viewBox="0 0 36 36" class="w-36 h-36 transform -rotate-90">
                    <circle cx="18" cy="18" r="15.915" fill="none" stroke-width="3" class="stroke-slate-200 dark:stroke-slate-700"/>
                    <circle id="donutPaid" cx="18" cy="18" r="15.915" fill="none" stroke-width="3" stroke-dasharray="0 100" class="stroke-emerald-500 transition-all duration-1000"/>
                    <circle id="donutPending" cx="18" cy="18" r="15.915" fill="none" stroke-width="3" stroke-dasharray="0 100" stroke-dashoffset="0" class="stroke-amber-500 transition-all duration-1000"/>
                    <circle id="donutOverdue" cx="18" cy="18" r="15.915" fill="none" stroke-width="3" stroke-dasharray="0 100" stroke-dashoffset="0" class="stroke-red-500 transition-all duration-1000"/>
                  </svg>
                  <div class="absolute inset-0 flex flex-col items-center justify-center">
                    <span id="donutTotal" class="text-lg font-bold text-slate-900 dark:text-white">0</span>
                    <span class="text-[10px] text-slate-500">Total Invoices</span>
                  </div>
                </div>
                <!-- Legend -->
                <div class="space-y-3">
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                    <div>
                      <p class="text-xs font-medium text-slate-900 dark:text-white">Paid</p>
                      <p id="legendPaid" class="text-[10px] text-slate-500">0 invoices</p>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                    <div>
                      <p class="text-xs font-medium text-slate-900 dark:text-white">Pending</p>
                      <p id="legendPending" class="text-[10px] text-slate-500">0 invoices</p>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div>
                      <p class="text-xs font-medium text-slate-900 dark:text-white">Overdue</p>
                      <p id="legendOverdue" class="text-[10px] text-slate-500">0 invoices</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Insights Row -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                </div>
                <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Collection Rate</h4>
              </div>
              <div class="flex items-end gap-2">
                <span id="collectionRate" class="text-2xl font-bold text-teal-600">0%</span>
                <span class="text-[10px] text-slate-500 mb-1">of total invoiced</span>
              </div>
              <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-1.5 mt-3">
                <div id="collectionBar" class="bg-teal-600 h-1.5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
            </div>

            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                </div>
                <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Active Plans</h4>
              </div>
              <div class="flex items-end gap-2">
                <span id="activePlansCount" class="text-2xl font-bold text-emerald-600">0</span>
                <span class="text-[10px] text-slate-500 mb-1">customers subscribed</span>
              </div>
              <div class="flex gap-1 mt-3" id="planTypeSplit">
                <div class="h-1.5 bg-teal-500 rounded-l-full transition-all duration-500" id="monthlyBar" style="width: 50%"></div>
                <div class="h-1.5 bg-cyan-500 rounded-r-full transition-all duration-500" id="yearlyBar" style="width: 50%"></div>
              </div>
              <div class="flex justify-between mt-1">
                <span class="text-[10px] text-teal-500">Monthly</span>
                <span class="text-[10px] text-cyan-500">Yearly</span>
              </div>
            </div>

            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/></svg>
                </div>
                <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Open Tickets</h4>
              </div>
              <div class="flex items-end gap-2">
                <span id="openTicketsCount" class="text-2xl font-bold text-amber-600">0</span>
                <span class="text-[10px] text-slate-500 mb-1">need attention</span>
              </div>
              <div class="flex gap-3 mt-3">
                <span id="ticketPendingBadge" class="text-[10px] px-2 py-0.5 bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 rounded-full">0 pending</span>
                <span id="ticketProgressBadge" class="text-[10px] px-2 py-0.5 bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400 rounded-full">0 in progress</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Invoicing & Payment Page -->
        <div id="page-invoicing" class="page-content hidden">
          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4">
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Total Outstanding</p>
                  <p class="text-lg font-bold text-slate-900 dark:text-white" id="totalOutstanding">₹0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
              </div>
            </div>
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Collected This Month</p>
                  <p class="text-lg font-bold text-green-600 dark:text-green-400" id="monthlyCollected">₹0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
              </div>
            </div>
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Pending Invoices</p>
                  <p class="text-lg font-bold text-amber-600 dark:text-amber-400" id="pendingInvoices">0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
              </div>
            </div>
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Overdue</p>
                  <p class="text-lg font-bold text-red-600 dark:text-red-400" id="overdueInvoices">0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Date Range Filter -->
          <div class="date-range-picker mb-4 relative" id="invoicingDatePicker">
            <button onclick="toggleDatePicker('invoicing', event)" class="date-range-trigger flex items-center gap-2 px-3 py-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-white rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-700 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <span id="invoicingDateDisplay" class="text-sm">Select Date Range</span>
            </button>
            <div id="invoicingCalendar" class="date-picker-dropdown hidden absolute z-50 mt-2 p-4 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl">
              <div class="flex gap-6">
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <button onclick="prevMonth('invoicing', 0)" class="p-1 hover:bg-slate-700 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button>
                    <span id="invoicingMonth0" class="text-sm font-medium">February 2026</span>
                    <div class="w-6"></div>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div>
                  <div id="invoicingDays0" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <div class="w-6"></div>
                    <span id="invoicingMonth1" class="text-sm font-medium">March 2026</span>
                    <button onclick="nextMonth('invoicing', 1)" class="p-1 hover:bg-slate-700 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div>
                  <div id="invoicingDays1" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
              </div>
              <div class="flex justify-end gap-2 mt-4 pt-3 border-t border-slate-700">
                <button onclick="clearDateRange('invoicing')" class="px-3 py-1.5 text-xs text-slate-400 hover:text-white transition-colors">Clear</button>
                <button onclick="applyDateRange('invoicing')" class="px-3 py-1.5 text-xs bg-teal-600 text-white rounded hover:bg-teal-700 transition-colors">Apply</button>
              </div>
            </div>
          </div>

          <!-- Action Bar -->
          <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
            <div class="flex items-center gap-2">
              <button onclick="openReconciliationModal()" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
                Reconciliation
              </button>
            </div>
            <div class="flex items-center gap-2">
              <select id="invoiceStatusFilter" onchange="filterInvoices()" class="px-2 py-1.5 text-xs border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="partial">Partial</option>
                <option value="paid">Paid</option>
                <option value="overdue">Overdue</option>
              </select>
              <input type="text" id="invoiceSearch" placeholder="Search invoices..." onkeyup="filterInvoices()" class="px-2 py-1.5 text-xs border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 w-40">
            </div>
          </div>

          <!-- Invoices Table -->
          <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-800/50">
                  <tr>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Invoice #</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Customer</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Invoice Date</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Due Date</th>
                    <th class="px-3 py-2 text-right font-medium text-slate-600 dark:text-slate-300">Amount</th>
                    <th class="px-3 py-2 text-right font-medium text-slate-600 dark:text-slate-300">Paid</th>
                    <th class="px-3 py-2 text-right font-medium text-slate-600 dark:text-slate-300">Balance</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Actions</th>
                  </tr>
                </thead>
                <tbody id="invoicesTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
                  <!-- Invoices will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="page-customers" class="page-content hidden">
          <!-- Customer Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4">
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Total Customers</p>
                  <p class="text-lg font-bold text-slate-900 dark:text-white" id="totalCustomers">0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                  </svg>
                </div>
              </div>
            </div>
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Monthly Plans</p>
                  <p class="text-lg font-bold text-teal-600 dark:text-teal-400" id="monthlyPlanCount">0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-teal-100 dark:bg-teal-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                </div>
              </div>
            </div>
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Yearly Plans</p>
                  <p class="text-lg font-bold text-cyan-600 dark:text-cyan-400" id="yearlyPlanCount">0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-cyan-100 dark:bg-cyan-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-cyan-600 dark:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                  </svg>
                </div>
              </div>
            </div>
            <div class="hover-card bg-white dark:bg-slate-900 rounded-lg p-3 border border-slate-200 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Active</p>
                  <p class="text-lg font-bold text-green-600 dark:text-green-400" id="activeCustomerCount">0</p>
                </div>
                <div class="w-8 h-8 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                  <svg class="w-4 h-4 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Date Range Filter -->
          <div class="date-range-picker mb-4 relative" id="customersDatePicker">
            <button onclick="toggleDatePicker('customers', event)" class="date-range-trigger flex items-center gap-2 px-3 py-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-white rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-700 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <span id="customersDateDisplay" class="text-sm">Select Date Range</span>
            </button>
            <div id="customersCalendar" class="date-picker-dropdown hidden absolute z-50 mt-2 p-4 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl">
              <div class="flex gap-6">
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <button onclick="prevMonth('customers', 0)" class="p-1 hover:bg-slate-700 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button>
                    <span id="customersMonth0" class="text-sm font-medium">February 2026</span>
                    <div class="w-6"></div>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div>
                  <div id="customersDays0" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <div class="w-6"></div>
                    <span id="customersMonth1" class="text-sm font-medium">March 2026</span>
                    <button onclick="nextMonth('customers', 1)" class="p-1 hover:bg-slate-700 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div>
                  <div id="customersDays1" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
              </div>
              <div class="flex justify-end gap-2 mt-4 pt-3 border-t border-slate-700">
                <button onclick="clearDateRange('customers')" class="px-3 py-1.5 text-xs text-slate-400 hover:text-white transition-colors">Clear</button>
                <button onclick="applyDateRange('customers')" class="px-3 py-1.5 text-xs bg-teal-600 text-white rounded hover:bg-teal-700 transition-colors">Apply</button>
              </div>
            </div>
          </div>

          <!-- Action Bar -->
          <div class="flex flex-wrap items-center justify-end gap-2 mb-4">
            <input type="text" id="customerSearch" placeholder="Search customers..." onkeyup="filterCustomers()" class="px-2 py-1.5 text-xs border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 w-40">
          </div>

          <!-- Customers Table -->
          <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-800/50">
                  <tr>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">ID</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Customer</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Email</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Plan</th>
                    <th class="px-3 py-2 text-right font-medium text-slate-600 dark:text-slate-300">Amount</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Actions</th>
                  </tr>
                </thead>
                <tbody id="customersTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
                  <!-- Customers will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="page-tickets" class="page-content hidden">
          <!-- Header -->
          <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
            <h3 class="text-base font-semibold text-slate-900 dark:text-white">Tickets</h3>
          </div>

          <!-- Stat Blocks -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
            <div class="dashboard-card hover-card bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-3">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-teal-600 flex items-center justify-center flex-shrink-0">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/></svg>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Total Tickets</p>
                  <p id="totalTickets" class="text-lg font-bold text-slate-900 dark:text-white">0</p>
                </div>
              </div>
            </div>
            <div class="dashboard-card hover-card bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-3">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center flex-shrink-0">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Pending</p>
                  <p id="pendingTickets" class="text-lg font-bold text-amber-600">0</p>
                </div>
              </div>
            </div>
            <div class="dashboard-card hover-card bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-3">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center flex-shrink-0">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">In Progress</p>
                  <p id="inProgressTickets" class="text-lg font-bold text-cyan-600">0</p>
                </div>
              </div>
            </div>
            <div class="dashboard-card hover-card bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-3">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center flex-shrink-0">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Closed</p>
                  <p id="closedTickets" class="text-lg font-bold text-emerald-600">0</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Date Range Filter -->
          <div class="date-range-picker mb-4 relative" id="ticketsDatePicker">
            <button onclick="toggleDatePicker('tickets', event)" class="date-range-trigger flex items-center gap-2 px-3 py-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-white rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-700 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <span id="ticketsDateDisplay" class="text-sm">Select Date Range</span>
            </button>
            <div id="ticketsCalendar" class="date-picker-dropdown hidden absolute z-50 mt-2 p-4 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl">
              <div class="flex gap-6">
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <button onclick="prevMonth('tickets', 0)" class="p-1 hover:bg-slate-700 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button>
                    <span id="ticketsMonth0" class="text-sm font-medium">February 2026</span>
                    <div class="w-6"></div>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div>
                  <div id="ticketsDays0" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
                <div class="calendar-month">
                  <div class="flex items-center justify-between mb-3">
                    <div class="w-6"></div>
                    <span id="ticketsMonth1" class="text-sm font-medium">March 2026</span>
                    <button onclick="nextMonth('tickets', 1)" class="p-1 hover:bg-slate-700 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>
                  </div>
                  <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div>
                  <div id="ticketsDays1" class="grid grid-cols-7 gap-1 text-sm"></div>
                </div>
              </div>
              <div class="flex justify-end gap-2 mt-4 pt-3 border-t border-slate-700">
                <button onclick="clearDateRange('tickets')" class="px-3 py-1.5 text-xs text-slate-400 hover:text-white transition-colors">Clear</button>
                <button onclick="applyDateRange('tickets')" class="px-3 py-1.5 text-xs bg-teal-600 text-white rounded hover:bg-teal-700 transition-colors">Apply</button>
              </div>
            </div>
          </div>

          <!-- Tickets Table -->
          <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-800/50">
                  <tr>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Ticket ID</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Customer</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Subject</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Priority</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Created</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Actions</th>
                  </tr>
                </thead>
                <tbody id="ticketsTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
                  <!-- Tickets populated dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="page-activity" class="page-content hidden">
          <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 text-center">
            <div class="w-10 h-10 mx-auto mb-3 rounded-xl bg-gradient-to-br from-teal-500 to-emerald-600 flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h3 class="text-lg font-bold mb-1">Activity Logs</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400">View system activity and audit logs.</p>
          </div>
        </div>

        <div id="page-settings" class="page-content hidden">
          <h3 class="text-base font-semibold text-slate-900 dark:text-white mb-4">Settings</h3>
          
          <div class="grid gap-4">
            <!-- Invoicing Configuration Section -->
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                </div>
                <div>
                  <h4 class="text-sm font-semibold">Invoicing Configuration</h4>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Set invoice generation date and payment due date for all customers</p>
                </div>
              </div>
              <div class="grid gap-4 max-w-md">
                <div>
                  <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Invoice Generation Day of Month</label>
                  <select id="invoiceGenDay" class="w-full px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                  </select>
                  <p class="text-[10px] text-slate-500 dark:text-slate-400 mt-1">Invoices will be auto-generated on this day every month for all customers</p>
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Payment Due Day of Month</label>
                  <select id="invoiceDueDay" class="w-full px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                  </select>
                  <p class="text-[10px] text-slate-500 dark:text-slate-400 mt-1">Customers must pay before this day each month</p>
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Email Reminder Frequency</label>
                  <div class="grid grid-cols-2 gap-3">
                    <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-3 border border-slate-200 dark:border-slate-700">
                      <p class="text-[10px] text-slate-500 dark:text-slate-400 mb-1">Monthly Plans</p>
                      <p class="text-xs font-semibold text-teal-600 dark:text-teal-400">Daily reminder</p>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-3 border border-slate-200 dark:border-slate-700">
                      <p class="text-[10px] text-slate-500 dark:text-slate-400 mb-1">Yearly Plans</p>
                      <p class="text-xs font-semibold text-teal-600 dark:text-teal-400">Weekly reminder</p>
                    </div>
                  </div>
                  <p class="text-[10px] text-slate-500 dark:text-slate-400 mt-1">Reminders are sent automatically for unpaid invoices</p>
                </div>
                <button onclick="saveInvoicingConfig()" class="w-fit px-4 py-2 text-xs font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition-colors flex items-center gap-1.5">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  Save Invoicing Config
                </button>
              </div>
            </div>

            <!-- Change Password Section -->
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                  </svg>
                </div>
                <div>
                  <h4 class="text-sm font-semibold">Change Password</h4>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Update your account password</p>
                </div>
              </div>
              <div class="grid gap-3 max-w-md">
                <div>
                  <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Current Password</label>
                  <input type="password" id="currentPassword" class="w-full px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">New Password</label>
                  <input type="password" id="newPassword" class="w-full px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Confirm New Password</label>
                  <input type="password" id="confirmPassword" class="w-full px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <button onclick="changePassword()" class="w-fit px-4 py-2 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">
                  Update Password
                </button>
              </div>
            </div>


          </div>
        </div>

        <!-- Plan Management Page -->
        <div id="page-plan-mgmt" class="page-content hidden">
          <!-- Header -->
          <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
            <h3 class="text-base font-semibold text-slate-900 dark:text-white">Plan Management</h3>
            <div class="flex items-center gap-2">
              <button onclick="openAddOfferModal()" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition-colors border border-emerald-700">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/>
                </svg>
                Add Offer
              </button>
              <button onclick="openAddPlanModal()" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors border border-teal-700">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                Add Plan
              </button>
            </div>
          </div>

          <!-- Plans Table -->
          <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-800/50">
                  <tr>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Plan Name</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Type</th>
                    <th class="px-3 py-2 text-right font-medium text-slate-600 dark:text-slate-300">Amount</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Actions</th>
                  </tr>
                </thead>
                <tbody id="plansTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
                  <!-- Plans populated dynamically -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Offers Section -->
          <div class="mt-6">
            <h4 class="text-sm font-semibold text-slate-900 dark:text-white mb-3">Active Offers</h4>
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full text-xs">
                  <thead class="bg-slate-50 dark:bg-slate-800/50">
                    <tr>
                      <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Offer Name</th>
                      <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Plan</th>
                      <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Discount %</th>
                      <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Validity</th>
                      <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                      <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="offersTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
                    <!-- Offers populated dynamically -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Customer Management Page -->
        <div id="page-customer-mgmt" class="page-content hidden">
          <!-- Header -->
          <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
            <h3 class="text-base font-semibold text-slate-900 dark:text-white">Customer Management</h3>
            <button onclick="openAddMgmtCustomerModal()" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors border border-teal-700">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add Customer
            </button>
          </div>

          <!-- Customer Table -->
          <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-800/50">
                  <tr>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">ID</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Name</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Email</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Phone</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Company</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Actions</th>
                  </tr>
                </thead>
                <tbody id="mgmtCustomersTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
                  <!-- Customers populated dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- User Management Page -->
        <div id="page-user-mgmt" class="page-content hidden">
          <!-- Header -->
          <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
            <h3 class="text-base font-semibold text-slate-900 dark:text-white">User Management</h3>
            <button onclick="openAddUserModal()" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors border border-teal-700">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add User
            </button>
          </div>

          <!-- User Table -->
          <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-800/50">
                  <tr>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">ID</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Name</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Email</th>
                    <th class="px-3 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Role</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                    <th class="px-3 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Actions</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
                  <!-- Users populated dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Generate Invoice Modal -->
    <div id="generateInvoiceModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Generate New Invoice</h3>
          <button onclick="closeModal('generateInvoiceModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Customer</label>
            <select id="invoiceCustomer" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <!-- Customers populated dynamically -->
            </select>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Invoice Date</label>
              <input type="date" id="invoiceDate" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Due Date</label>
              <input type="date" id="invoiceDueDate" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Description</label>
            <input type="text" id="invoiceDescription" placeholder="Service description" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Amount (₹)</label>
            <input type="number" id="invoiceAmount" placeholder="0.00" step="0.01" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('generateInvoiceModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="createInvoice()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Generate Invoice</button>
        </div>
      </div>
    </div>

    <!-- Record Payment Modal -->
    <div id="recordPaymentModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Record Payment</h3>
          <button onclick="closeModal('recordPaymentModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div id="paymentInvoiceInfo" class="p-3 bg-slate-50 dark:bg-slate-800 rounded-lg mb-3">
          <!-- Invoice info populated dynamically -->
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Payment Amount (₹)</label>
            <input type="number" id="paymentAmount" placeholder="0.00" step="0.01" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Payment Method</label>
            <select id="paymentMethod" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="bank_transfer">Bank Transfer</option>
              <option value="upi">UPI</option>
              <option value="cash">Cash</option>
              <option value="cheque">Cheque</option>
              <option value="card">Card</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Reference Number</label>
            <input type="text" id="paymentReference" placeholder="Transaction ID or Cheque No." class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('recordPaymentModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="savePayment()" class="px-3 py-1.5 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors">Record Payment</button>
        </div>
      </div>
    </div>

    <!-- Reconciliation Modal -->
    <div id="reconciliationModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-2xl mx-4 p-4 shadow-xl max-h-[80vh] overflow-hidden flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Payment Reconciliation</h3>
          <button onclick="closeModal('reconciliationModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="grid grid-cols-3 gap-3 mb-4">
          <div class="p-2 bg-green-50 dark:bg-green-900/20 rounded-lg text-center">
            <p class="text-xs text-green-600 dark:text-green-400">Matched</p>
            <p class="text-lg font-bold text-green-700 dark:text-green-300" id="matchedCount">0</p>
          </div>
          <div class="p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-center">
            <p class="text-xs text-amber-600 dark:text-amber-400">Pending</p>
            <p class="text-lg font-bold text-amber-700 dark:text-amber-300" id="pendingRecCount">0</p>
          </div>
          <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded-lg text-center">
            <p class="text-xs text-red-600 dark:text-red-400">Unmatched</p>
            <p class="text-lg font-bold text-red-700 dark:text-red-300" id="unmatchedCount">0</p>
          </div>
        </div>
        <div class="overflow-auto flex-1">
          <table class="w-full text-xs">
            <thead class="bg-slate-50 dark:bg-slate-800/50 sticky top-0">
              <tr>
                <th class="px-2 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Payment</th>
                <th class="px-2 py-2 text-left font-medium text-slate-600 dark:text-slate-300">Invoice</th>
                <th class="px-2 py-2 text-right font-medium text-slate-600 dark:text-slate-300">Amount</th>
                <th class="px-2 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Status</th>
                <th class="px-2 py-2 text-center font-medium text-slate-600 dark:text-slate-300">Action</th>
              </tr>
            </thead>
            <tbody id="reconciliationTableBody" class="divide-y divide-slate-200 dark:divide-slate-800">
              <!-- Reconciliation rows populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Invoice Preview Modal -->
    <div id="invoiceModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-lg mx-4 shadow-xl max-h-[85vh] overflow-hidden flex flex-col">
        <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Invoice Preview</h3>
          <div class="flex items-center gap-2">
            <button onclick="downloadInvoice()" class="flex items-center gap-1 px-2 py-1 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded transition-colors">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
              </svg>
              Download
            </button>
            <button onclick="closeModal('invoiceModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>
        <div id="invoiceContent" class="p-6 overflow-auto flex-1 bg-white">
          <!-- Invoice content populated dynamically -->
        </div>
      </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Add New Customer</h3>
          <button onclick="closeModal('addCustomerModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Customer Name</label>
            <input type="text" id="newCustomerName" placeholder="Full name" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
            <input type="email" id="newCustomerEmail" placeholder="email@example.com" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Subscription Plan</label>
            <select id="newCustomerPlan" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="Basic" data-amount="999">Basic - ₹999/month</option>
              <option value="Premium" data-amount="2999">Premium - ₹2,999/month</option>
              <option value="Enterprise" data-amount="9999">Enterprise - ₹9,999/month</option>
            </select>
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('addCustomerModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="addCustomer()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Add Customer</button>
        </div>
      </div>
    </div>

    <!-- Add Management Customer Modal -->
    <div id="addMgmtCustomerModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Add New Customer</h3>
          <button onclick="closeModal('addMgmtCustomerModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Full Name</label>
            <input type="text" id="mgmtCustomerName" placeholder="Customer name" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
            <input type="email" id="mgmtCustomerEmail" placeholder="email@example.com" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Phone</label>
            <input type="tel" id="mgmtCustomerPhone" placeholder="+91 98765 43210" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Company</label>
            <input type="text" id="mgmtCustomerCompany" placeholder="Company name" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Status</label>
            <select id="mgmtCustomerStatus" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="pending">Pending</option>
            </select>
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('addMgmtCustomerModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="addMgmtCustomer()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Add Customer</button>
        </div>
      </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Add New Employee</h3>
          <button onclick="closeModal('addUserModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Full Name</label>
            <input type="text" id="newUserName" placeholder="Employee full name" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Employee ID</label>
            <input type="text" id="newUserEmpId" placeholder="EMP001" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
            <input type="email" id="newUserEmail" placeholder="email@radix.com" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Role</label>
            <select id="newUserRole" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="admin">Admin</option>
              <option value="manager">Manager</option>
              <option value="staff" selected>Staff</option>
              <option value="viewer">Viewer</option>
            </select>
          </div>
        </div>
        <p class="mt-3 text-xs text-slate-500 dark:text-slate-400 italic">* A default password will be sent to the employee's email address.</p>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('addUserModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="addUser()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Add Employee</button>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Edit Employee</h3>
          <button onclick="closeModal('editUserModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Full Name</label>
            <input type="text" id="editUserName" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Employee ID</label>
            <input type="text" id="editUserEmpId" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
            <input type="email" id="editUserEmail" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Role</label>
            <select id="editUserRole" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="admin">Admin</option>
              <option value="manager">Manager</option>
              <option value="staff">Staff</option>
              <option value="viewer">Viewer</option>
            </select>
          </div>
        </div>
        <input type="hidden" id="editUserId">
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('editUserModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="saveUserEdit()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Save Changes</button>
        </div>
      </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="editMgmtCustomerModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Edit Customer</h3>
          <button onclick="closeModal('editMgmtCustomerModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Full Name</label>
            <input type="text" id="editMgmtCustomerName" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
            <input type="email" id="editMgmtCustomerEmail" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Phone</label>
            <input type="tel" id="editMgmtCustomerPhone" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Company</label>
            <input type="text" id="editMgmtCustomerCompany" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Status</label>
            <select id="editMgmtCustomerStatus" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="pending">Pending</option>
            </select>
          </div>
        </div>
        <input type="hidden" id="editMgmtCustomerId">
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('editMgmtCustomerModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="saveCustomerEdit()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Save Changes</button>
        </div>
      </div>
    </div>

    <!-- Add Plan Modal -->
    <div id="addPlanModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Add New Plan</h3>
          <button onclick="closeModal('addPlanModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Plan Name *</label>
            <input type="text" id="newPlanName" placeholder="e.g., Basic Plan" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Subscription Amount (₹) *</label>
            <input type="number" id="newPlanAmount" placeholder="e.g., 999" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Plan Type *</label>
            <select id="newPlanType" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('addPlanModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="addPlan()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Add Plan</button>
        </div>
      </div>
    </div>

    <!-- Edit Plan Modal -->
    <div id="editPlanModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Edit Plan</h3>
          <button onclick="closeModal('editPlanModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Plan Name</label>
            <input type="text" id="editPlanName" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Subscription Amount (₹)</label>
            <input type="number" id="editPlanAmount" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Plan Type</label>
            <select id="editPlanType" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Status</label>
            <select id="editPlanStatus" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </div>
        <input type="hidden" id="editPlanId">
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('editPlanModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="savePlanEdit()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Save Changes</button>
        </div>
      </div>
    </div>

    <!-- Add Offer Modal -->
    <div id="addOfferModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Add New Offer</h3>
          <button onclick="closeModal('addOfferModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Offer Name</label>
            <input type="text" id="offerName" placeholder="e.g., New Year Special" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Discount Percentage (%)</label>
            <input type="number" id="offerDiscount" min="1" max="100" placeholder="e.g., 20" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Select Plan</label>
            <select id="offerPlan" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="">-- Select a Plan --</option>
              <!-- Plans populated dynamically -->
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Offer Validity</label>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="block text-[10px] text-slate-500 dark:text-slate-400 mb-0.5">Start Date</label>
                <div class="relative">
                  <input type="text" id="offerStartDate" readonly placeholder="Select date" onclick="toggleOfferCalendar('offerStartDate', event)" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 cursor-pointer">
                  <div id="offerStartDate_calendar" class="hidden absolute z-[60] mt-1 p-3 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl min-w-[220px]"></div>
                </div>
              </div>
              <div>
                <label class="block text-[10px] text-slate-500 dark:text-slate-400 mb-0.5">End Date</label>
                <div class="relative">
                  <input type="text" id="offerEndDate" readonly placeholder="Select date" onclick="toggleOfferCalendar('offerEndDate', event)" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 cursor-pointer">
                  <div id="offerEndDate_calendar" class="hidden absolute z-[60] mt-1 p-3 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl min-w-[220px]"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('addOfferModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="addOffer()" class="px-3 py-1.5 text-xs font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition-colors">Add Offer</button>
        </div>
      </div>
    </div>

    <!-- Edit Offer Modal -->
    <div id="editOfferModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">Edit Offer</h3>
          <button onclick="closeModal('editOfferModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Offer Name</label>
            <input type="text" id="editOfferName" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Discount Percentage (%)</label>
            <input type="number" id="editOfferDiscount" min="1" max="100" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Select Plan</label>
            <select id="editOfferPlan" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="">-- Select a Plan --</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Offer Validity</label>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="block text-[10px] text-slate-500 dark:text-slate-400 mb-0.5">Start Date</label>
                <div class="relative">
                  <input type="text" id="editOfferStartDate" readonly placeholder="Select date" onclick="toggleOfferCalendar('editOfferStartDate', event)" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 cursor-pointer">
                  <div id="editOfferStartDate_calendar" class="hidden absolute z-[60] mt-1 p-3 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl min-w-[220px]"></div>
                </div>
              </div>
              <div>
                <label class="block text-[10px] text-slate-500 dark:text-slate-400 mb-0.5">End Date</label>
                <div class="relative">
                  <input type="text" id="editOfferEndDate" readonly placeholder="Select date" onclick="toggleOfferCalendar('editOfferEndDate', event)" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 cursor-pointer">
                  <div id="editOfferEndDate_calendar" class="hidden absolute z-[60] mt-1 p-3 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl min-w-[220px]"></div>
                </div>
              </div>
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Status</label>
            <select id="editOfferStatus" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </div>
        <input type="hidden" id="editOfferId">
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('editOfferModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="saveOfferEdit()" class="px-3 py-1.5 text-xs font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition-colors">Save Changes</button>
        </div>
      </div>
    </div>

    <!-- Add Ticket Modal -->
    <div id="addTicketModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md mx-4 p-4 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-base font-bold text-slate-900 dark:text-white">New Support Ticket</h3>
          <button onclick="closeModal('addTicketModal')" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Customer</label>
            <select id="ticketCustomer" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="">-- Select Customer --</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Subject</label>
            <input type="text" id="ticketSubject" placeholder="Brief description of the issue" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Description</label>
            <textarea id="ticketDescription" rows="3" placeholder="Detailed description..." class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200"></textarea>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1">Priority</label>
            <select id="ticketPriority" class="w-full px-2 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
              <option value="urgent">Urgent</option>
            </select>
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button onclick="closeModal('addTicketModal')" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">Cancel</button>
          <button onclick="addTicket()" class="px-3 py-1.5 text-xs font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">Create Ticket</button>
        </div>
      </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Custom Confirm Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[100]">
      <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-sm mx-4 p-5 shadow-2xl border border-slate-200 dark:border-slate-700">
        <div class="flex items-center gap-3 mb-3">
          <div class="w-9 h-9 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
          </div>
          <h3 id="confirmTitle" class="text-sm font-bold text-slate-900 dark:text-white">Confirm Action</h3>
        </div>
        <p id="confirmMessage" class="text-xs text-slate-600 dark:text-slate-400 mb-5 ml-12">Are you sure?</p>
        <div class="flex justify-end gap-2">
          <button id="confirmCancel" class="px-4 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors border border-slate-200 dark:border-slate-700">Cancel</button>
          <button id="confirmOk" class="px-4 py-1.5 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors">Delete</button>
        </div>
      </div>
    </div>

    <script>
      const STORAGE_KEY = 'radix_state';

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : null;
        } catch {
          return null;
        }
      }

      function saveState(state) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      // ===== TOAST NOTIFICATION SYSTEM =====
      function showToast(message, type = 'info', duration = 3000) {
        const container = document.getElementById('toastContainer');
        const icons = {
          success: '<svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
          error: '<svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
          warning: '<svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>',
          info: '<svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
        };
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `${icons[type] || icons.info}<span>${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => {
          toast.classList.add('toast-exit');
          setTimeout(() => toast.remove(), 300);
        }, duration);
      }

      // ===== CUSTOM CONFIRM DIALOG =====
      function showConfirm(message, title = 'Confirm Action') {
        return new Promise((resolve) => {
          const modal = document.getElementById('confirmModal');
          document.getElementById('confirmTitle').textContent = title;
          document.getElementById('confirmMessage').textContent = message;
          modal.classList.remove('hidden');
          modal.classList.add('flex');

          const okBtn = document.getElementById('confirmOk');
          const cancelBtn = document.getElementById('confirmCancel');

          function cleanup() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            okBtn.removeEventListener('click', onOk);
            cancelBtn.removeEventListener('click', onCancel);
          }
          function onOk() { cleanup(); resolve(true); }
          function onCancel() { cleanup(); resolve(false); }

          okBtn.addEventListener('click', onOk);
          cancelBtn.addEventListener('click', onCancel);
        });
      }

      // ===== OFFER MINI CALENDAR =====
      const offerCalState = {};

      function toggleOfferCalendar(inputId, evt) {
        if (evt) evt.stopPropagation();
        const cal = document.getElementById(inputId + '_calendar');
        if (!cal) return;

        // Close all other offer calendars
        document.querySelectorAll('[id$="_calendar"]').forEach(c => {
          if (c.id !== inputId + '_calendar') c.classList.add('hidden');
        });

        if (cal.classList.contains('hidden')) {
          if (!offerCalState[inputId]) {
            const currentVal = document.getElementById(inputId).value;
            let initDate = currentVal ? new Date(currentVal) : new Date();
            offerCalState[inputId] = { year: initDate.getFullYear(), month: initDate.getMonth() };
          }
          cal.classList.remove('hidden');
          renderOfferCalendar(inputId);
        } else {
          cal.classList.add('hidden');
        }
      }

      function renderOfferCalendar(inputId) {
        const cal = document.getElementById(inputId + '_calendar');
        const s = offerCalState[inputId];
        const currentVal = document.getElementById(inputId).value;
        const selectedDate = currentVal || '';
        const today = new Date();
        const todayStr = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;

        const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        const firstDay = new Date(s.year, s.month, 1).getDay();
        const daysInMonth = new Date(s.year, s.month + 1, 0).getDate();
        const daysInPrev = new Date(s.year, s.month, 0).getDate();

        let html = `
          <div class="flex items-center justify-between mb-2">
            <button type="button" onclick="offerCalNav('${inputId}',-1, event)" class="p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-white">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </button>
            <span class="text-xs font-semibold text-white">${monthNames[s.month]} ${s.year}</span>
            <button type="button" onclick="offerCalNav('${inputId}',1, event)" class="p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-white">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
          </div>
          <div class="grid grid-cols-7 gap-0 text-center mb-1">
            <span class="text-[9px] text-slate-500 py-1">Su</span><span class="text-[9px] text-slate-500 py-1">Mo</span><span class="text-[9px] text-slate-500 py-1">Tu</span><span class="text-[9px] text-slate-500 py-1">We</span><span class="text-[9px] text-slate-500 py-1">Th</span><span class="text-[9px] text-slate-500 py-1">Fr</span><span class="text-[9px] text-slate-500 py-1">Sa</span>
          </div>
          <div class="grid grid-cols-7 gap-0">`;

        // Previous month padding
        for (let i = firstDay - 1; i >= 0; i--) {
          html += `<div class="offer-cal-day other">${daysInPrev - i}</div>`;
        }

        // Current month days
        for (let d = 1; d <= daysInMonth; d++) {
          const dateStr = `${s.year}-${String(s.month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
          let cls = 'offer-cal-day';
          if (dateStr === selectedDate) cls += ' selected';
          if (dateStr === todayStr) cls += ' today';
          html += `<div class="${cls}" data-input="${inputId}" data-val="${dateStr}">${d}</div>`;
        }

        // Next month padding
        const total = firstDay + daysInMonth;
        const rem = (7 - (total % 7)) % 7;
        for (let d = 1; d <= rem; d++) {
          html += `<div class="offer-cal-day other">${d}</div>`;
        }

        html += `</div>
          <div class="flex justify-between mt-2 pt-2 border-t border-slate-700">
            <button type="button" onclick="offerCalClear('${inputId}', event)" class="text-[10px] text-slate-400 hover:text-white">Clear</button>
            <button type="button" onclick="offerCalToday('${inputId}', event)" class="text-[10px] text-teal-400 hover:text-teal-300">Today</button>
          </div>`;

        cal.innerHTML = html;

        // Attach click listeners
        cal.querySelectorAll('.offer-cal-day:not(.other)').forEach(el => {
          el.addEventListener('click', function(e) {
            e.stopPropagation();
            const inp = this.getAttribute('data-input');
            const val = this.getAttribute('data-val');
            document.getElementById(inp).value = val;
            document.getElementById(inp + '_calendar').classList.add('hidden');
          });
        });
      }

      function offerCalNav(inputId, dir, evt) {
        if (evt) evt.stopPropagation();
        const s = offerCalState[inputId];
        s.month += dir;
        if (s.month < 0) { s.month = 11; s.year--; }
        if (s.month > 11) { s.month = 0; s.year++; }
        renderOfferCalendar(inputId);
      }

      function offerCalClear(inputId, evt) {
        if (evt) evt.stopPropagation();
        document.getElementById(inputId).value = '';
        document.getElementById(inputId + '_calendar').classList.add('hidden');
      }

      function offerCalToday(inputId, evt) {
        if (evt) evt.stopPropagation();
        const t = new Date();
        document.getElementById(inputId).value = `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
        document.getElementById(inputId + '_calendar').classList.add('hidden');
      }

      // Close offer calendars on outside click
      document.addEventListener('click', function(e) {
        document.querySelectorAll('[id$="_calendar"]').forEach(cal => {
          if (!cal.classList.contains('hidden') && !cal.contains(e.target)) {
            const inputId = cal.id.replace('_calendar', '');
            const input = document.getElementById(inputId);
            if (input && !input.contains(e.target)) {
              cal.classList.add('hidden');
            }
          }
        });
      });

      const state = loadState() || {
        auth: { userId: null, isAuthed: false, role: null },
        ui: { theme: 'light', sidebarCollapsed: false }
      };

      // Auth check
      if (!state.auth?.isAuthed || state.auth?.role !== 'superadmin') {
        window.location.href = './login.html';
      }

      // Apply theme
      function applyTheme(theme) {
        document.documentElement.classList.toggle('dark', theme === 'dark');
      }
      applyTheme(state.ui?.theme || 'dark');

      // Update user name
      const userName = state.auth?.name || state.auth?.userId || 'Admin';
      document.getElementById('userName').textContent = userName;

      // Sidebar (hover to expand)
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');

      // Page navigation
      const menuItems = document.querySelectorAll('.menu-item');
      const pages = {
        dashboard: { title: 'Dashboard', el: document.getElementById('page-dashboard') },
        invoicing: { title: 'Invoicing & Payment', el: document.getElementById('page-invoicing') },
        customers: { title: 'My Customers', el: document.getElementById('page-customers') },
        tickets: { title: 'Tickets', el: document.getElementById('page-tickets') },
        activity: { title: 'Activity Logs', el: document.getElementById('page-activity') },
        'plan-mgmt': { title: 'Plan Management', el: document.getElementById('page-plan-mgmt') },
        'customer-mgmt': { title: 'Customer Management', el: document.getElementById('page-customer-mgmt') },
        'user-mgmt': { title: 'User Management', el: document.getElementById('page-user-mgmt') },
        settings: { title: 'Settings', el: document.getElementById('page-settings') }
      };

      function showPage(pageId) {
        // Hide all pages
        Object.values(pages).forEach(p => {
          p.el.classList.add('hidden');
          p.el.classList.remove('page-content');
        });
        
        // Show selected page with animation
        if (pages[pageId]) {
          pages[pageId].el.classList.remove('hidden');
          // Trigger reflow for animation
          void pages[pageId].el.offsetWidth;
          pages[pageId].el.classList.add('page-content');
          document.getElementById('pageTitle').textContent = pages[pageId].title;
        }
        
        // Update active menu item
        menuItems.forEach(item => {
          item.classList.toggle('active', item.dataset.page === pageId);
        });
      }

      menuItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const pageId = item.dataset.page;
          showPage(pageId);
          window.location.hash = pageId;
        });
      });

      // Handle initial hash
      const initialPage = window.location.hash.slice(1) || 'dashboard';
      showPage(initialPage);

      // Theme toggle
      document.getElementById('themeToggle').addEventListener('click', () => {
        const newTheme = state.ui.theme === 'dark' ? 'light' : 'dark';
        state.ui.theme = newTheme;
        saveState(state);
        applyTheme(newTheme);
      });

      // Logout
      document.getElementById('logoutBtn').addEventListener('click', () => {
        state.auth = { userId: null, isAuthed: false, role: null };
        saveState(state);
        window.location.href = './login.html';
      });

      // ===== BILLING SYSTEM =====
      
      // ===== DATA PERSISTENCE (localStorage) =====
      const DATA_KEY = 'radix_data';

      function loadAppData() {
        try {
          const raw = localStorage.getItem(DATA_KEY);
          return raw ? JSON.parse(raw) : null;
        } catch { return null; }
      }

      function saveAppData() {
        const data = {
          customers, invoices, payments, plans, offers, tickets, mgmtCustomers, users
        };
        localStorage.setItem(DATA_KEY, JSON.stringify(data));
      }

      const savedData = loadAppData();

      // Data Arrays
      let customers = savedData?.customers || [];
      let invoices = savedData?.invoices || [];
      let payments = savedData?.payments || [];
      let plans = savedData?.plans || [];
      let offers = savedData?.offers || [];
      let tickets = savedData?.tickets || [];

      let currentInvoiceForPayment = null;
      let currentInvoiceInvoice = null;

      // Initialize invoicing data
      function initInvoicing() {
        populateCustomerDropdown();
        renderInvoicesTable();
        updateInvoicingSummary();
        setDefaultDates();
      }

      function setDefaultDates() {
        const today = new Date().toISOString().split('T')[0];
        const dueDate = new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        document.getElementById('invoiceDate').value = today;
        document.getElementById('invoiceDueDate').value = dueDate;
      }

      function populateCustomerDropdown() {
        const select = document.getElementById('invoiceCustomer');
        select.innerHTML = customers.map(c => 
          `<option value="${c.id}">${c.name} - ${c.plan} (₹${c.amount})</option>`
        ).join('');
      }

      function updateInvoicingSummary() {
        const totalOutstanding = invoices.reduce((sum, b) => sum + (b.amount - b.paid), 0);
        const monthlyCollected = invoices.filter(b => b.status === 'paid').reduce((sum, b) => sum + b.amount, 0);
        const pendingCount = invoices.filter(b => b.status === 'pending').length;
        const overdueCount = invoices.filter(b => b.status === 'overdue').length;

        document.getElementById('totalOutstanding').textContent = '₹' + totalOutstanding.toLocaleString('en-IN');
        document.getElementById('monthlyCollected').textContent = '₹' + monthlyCollected.toLocaleString('en-IN');
        document.getElementById('pendingInvoices').textContent = pendingCount;
        document.getElementById('overdueInvoices').textContent = overdueCount;
      }

      function renderInvoicesTable(filteredInvoices = invoices) {
        const tbody = document.getElementById('invoicesTableBody');
        if (!tbody) return;
        
        tbody.innerHTML = filteredInvoices.map(invoice => {
          const balance = invoice.amount - invoice.paid;
          const statusColors = {
            paid: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
            pending: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
            partial: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
            overdue: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'
          };
          
          return `
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
              <td class="px-3 py-2 font-medium text-teal-600 dark:text-teal-400">${invoice.id}</td>
              <td class="px-3 py-2 text-slate-900 dark:text-white">${invoice.customer}</td>
              <td class="px-3 py-2 text-slate-600 dark:text-slate-400">${formatDate(invoice.invoiceDate)}</td>
              <td class="px-3 py-2 text-slate-600 dark:text-slate-400">${formatDate(invoice.dueDate)}</td>
              <td class="px-3 py-2 text-right font-medium text-slate-900 dark:text-white">₹${invoice.amount.toLocaleString('en-IN')}</td>
              <td class="px-3 py-2 text-right text-green-600 dark:text-green-400">₹${invoice.paid.toLocaleString('en-IN')}</td>
              <td class="px-3 py-2 text-right font-medium ${balance > 0 ? 'text-red-600 dark:text-red-400' : 'text-slate-600 dark:text-slate-400'}">₹${balance.toLocaleString('en-IN')}</td>
              <td class="px-3 py-2 text-center">
                <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusColors[invoice.status]}">${invoice.status.toUpperCase()}</span>
              </td>
              <td class="px-3 py-2 text-center">
                <div class="flex items-center justify-center gap-1">
                  <button onclick="viewInvoice('${invoice.id}')" class="p-1 text-slate-400 hover:text-teal-600 dark:hover:text-teal-400" title="View Invoice">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                  </button>
                  ${invoice.status !== 'paid' ? `
                    <button onclick="openPaymentModal('${invoice.id}')" class="p-1 text-slate-400 hover:text-green-600 dark:hover:text-green-400" title="Record Payment">
                      <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                      </svg>
                    </button>
                  ` : ''}
                  <button onclick="downloadInvoiceForInvoice('${invoice.id}')" class="p-1 text-slate-400 hover:text-blue-600 dark:hover:text-blue-400" title="Download Invoice">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }

      function formatDate(dateStr) {
        return new Date(dateStr).toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
      }

      function filterInvoices() {
        const status = document.getElementById('invoiceStatusFilter').value;
        const search = document.getElementById('invoiceSearch').value.toLowerCase();
        
        const filtered = invoices.filter(invoice => {
          const matchesStatus = !status || invoice.status === status;
          const matchesSearch = !search || 
            invoice.id.toLowerCase().includes(search) || 
            invoice.customer.toLowerCase().includes(search);
          return matchesStatus && matchesSearch;
        });
        
        renderInvoicesTable(filtered);
      }

      // Modal functions
      function openModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }

      function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }

      function openGenerateInvoiceModal() {
        setDefaultDates();
        openModal('generateInvoiceModal');
      }

      function createInvoice() {
        const customerId = document.getElementById('invoiceCustomer').value;
        const customer = customers.find(c => c.id === customerId);
        const description = document.getElementById('invoiceDescription').value || `${customer.plan} Plan - Subscription`;
        const amount = parseFloat(document.getElementById('invoiceAmount').value) || customer.amount;
        const invoiceDate = document.getElementById('invoiceDate').value;
        const dueDate = document.getElementById('invoiceDueDate').value;
        
        const newInvoice = {
          id: `INV-${new Date().getFullYear()}-${String(invoices.length + 1).padStart(3, '0')}`,
          customerId,
          customer: customer.name,
          description,
          invoiceDate,
          dueDate,
          amount,
          paid: 0,
          status: 'pending'
        };
        
        invoices.unshift(newInvoice);
        saveAppData();
        renderInvoicesTable();
        updateInvoicingSummary();
        closeModal('generateInvoiceModal');
        
        // Clear form
        document.getElementById('invoiceDescription').value = '';
        document.getElementById('invoiceAmount').value = '';
      }

      function openPaymentModal(invoiceId) {
        const invoice = invoices.find(b => b.id === invoiceId);
        if (!invoice) return;
        
        currentInvoiceForPayment = invoice;
        const balance = invoice.amount - invoice.paid;
        
        document.getElementById('paymentInvoiceInfo').innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <p class="font-medium text-slate-900 dark:text-white">${invoice.id}</p>
              <p class="text-xs text-slate-500 dark:text-slate-400">${invoice.customer}</p>
            </div>
            <div class="text-right">
              <p class="text-xs text-slate-500 dark:text-slate-400">Balance Due</p>
              <p class="font-bold text-red-600 dark:text-red-400">₹${balance.toLocaleString('en-IN')}</p>
            </div>
          </div>
        `;
        
        document.getElementById('paymentAmount').value = balance;
        document.getElementById('paymentReference').value = '';
        openModal('recordPaymentModal');
      }

      function savePayment() {
        if (!currentInvoiceForPayment) return;
        
        const amount = parseFloat(document.getElementById('paymentAmount').value);
        const method = document.getElementById('paymentMethod').value;
        const reference = document.getElementById('paymentReference').value;
        
        if (!amount || amount <= 0) {
          showToast('Please enter a valid payment amount', 'warning');
          return;
        }
        
        const balance = currentInvoiceForPayment.amount - currentInvoiceForPayment.paid;
        if (amount > balance) {
          showToast('Payment amount cannot exceed balance due', 'warning');
          return;
        }
        
        // Record payment
        const newPayment = {
          id: `PAY${String(payments.length + 1).padStart(3, '0')}`,
          invoiceId: currentInvoiceForPayment.id,
          amount,
          method,
          reference,
          date: new Date().toISOString().split('T')[0],
          reconciled: 'pending'
        };
        payments.push(newPayment);
        
        // Update invoice
        currentInvoiceForPayment.paid += amount;
        if (currentInvoiceForPayment.paid >= currentInvoiceForPayment.amount) {
          currentInvoiceForPayment.status = 'paid';
        } else {
          currentInvoiceForPayment.status = 'partial';
        }
        
        saveAppData();
        renderInvoicesTable();
        updateInvoicingSummary();
        closeModal('recordPaymentModal');
        currentInvoiceForPayment = null;
      }

      function openReconciliationModal() {
        updateReconciliationStats();
        renderReconciliationTable();
        openModal('reconciliationModal');
      }

      function updateReconciliationStats() {
        const matched = payments.filter(p => p.reconciled === 'matched').length;
        const pending = payments.filter(p => p.reconciled === 'pending').length;
        const unmatched = payments.filter(p => p.reconciled === 'unmatched').length;
        
        document.getElementById('matchedCount').textContent = matched;
        document.getElementById('pendingRecCount').textContent = pending;
        document.getElementById('unmatchedCount').textContent = unmatched;
      }

      function renderReconciliationTable() {
        const tbody = document.getElementById('reconciliationTableBody');
        
        tbody.innerHTML = payments.map(payment => {
          const invoice = invoices.find(b => b.id === payment.invoiceId);
          const statusColors = {
            matched: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
            pending: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
            unmatched: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'
          };
          
          return `
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
              <td class="px-2 py-2">
                <p class="font-medium text-slate-900 dark:text-white">${payment.id}</p>
                <p class="text-[10px] text-slate-500">${payment.reference}</p>
              </td>
              <td class="px-2 py-2 text-slate-600 dark:text-slate-400">${invoice ? invoice.id : 'Not linked'}</td>
              <td class="px-2 py-2 text-right font-medium text-slate-900 dark:text-white">₹${payment.amount.toLocaleString('en-IN')}</td>
              <td class="px-2 py-2 text-center">
                <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusColors[payment.reconciled]}">${payment.reconciled.toUpperCase()}</span>
              </td>
              <td class="px-2 py-2 text-center">
                ${payment.reconciled === 'pending' ? `
                  <button onclick="reconcilePayment('${payment.id}')" class="px-2 py-0.5 text-[10px] text-white bg-green-600 hover:bg-green-700 rounded transition-colors">Match</button>
                ` : payment.reconciled === 'unmatched' ? `
                  <button onclick="linkPayment('${payment.id}')" class="px-2 py-0.5 text-[10px] text-white bg-blue-600 hover:bg-blue-700 rounded transition-colors">Link</button>
                ` : '✓'}
              </td>
            </tr>
          `;
        }).join('');
      }

      function reconcilePayment(paymentId) {
        const payment = payments.find(p => p.id === paymentId);
        if (payment) {
          payment.reconciled = 'matched';
          updateReconciliationStats();
          renderReconciliationTable();
        }
      }

      function linkPayment(paymentId) {
        const payment = payments.find(p => p.id === paymentId);
        if (!payment) return;
        
        const pendingInvoices = invoices.filter(b => b.status === 'pending' || b.status === 'partial');
        if (pendingInvoices.length === 0) {
          showToast('No pending invoices to link', 'warning');
          return;
        }
        
        const invoiceOptions = pendingInvoices.map(b => `${b.id} - ${b.customer} (₹${b.amount - b.paid} due)`).join('\n');
        const selection = prompt(`Link payment to which invoice?\n\n${invoiceOptions}\n\nEnter Invoice ID:`);
        
        if (selection) {
          const invoice = invoices.find(b => b.id === selection.trim().toUpperCase());
          if (invoice) {
            payment.invoiceId = invoice.id;
            payment.reconciled = 'matched';
            invoice.paid += payment.amount;
            if (invoice.paid >= invoice.amount) invoice.status = 'paid';
            else invoice.status = 'partial';
            
            updateReconciliationStats();
            renderReconciliationTable();
            renderInvoicesTable();
            updateInvoicingSummary();
          } else {
            showToast('Invoice not found', 'error');
          }
        }
      }

      // Invoice functions
      function viewInvoice(invoiceId) {
        const invoice = invoices.find(b => b.id === invoiceId);
        if (!invoice) return;
        
        currentInvoiceInvoice = invoice;
        const customer = customers.find(c => c.id === invoice.customerId) || { email: 'customer@example.com' };
        
        document.getElementById('invoiceContent').innerHTML = `
          <div class="text-slate-900" style="font-family: 'Inter', sans-serif;">
            <!-- Header -->
            <div class="flex justify-between items-start mb-6">
              <div>
                <h1 class="text-xl font-bold text-teal-600" style="font-family: 'Merriweather', serif;">Record Rx</h1>
                <p class="text-xs text-slate-500">Invoicing & Payment Management</p>
              </div>
              <div class="text-right">
                <h2 class="text-lg font-bold">INVOICE</h2>
                <p class="text-sm text-teal-600 font-medium">${invoice.id}</p>
              </div>
            </div>
            
            <!-- Dates & Details -->
            <div class="grid grid-cols-2 gap-4 mb-6 text-xs">
              <div>
                <p class="text-slate-500 mb-1">Invoice To:</p>
                <p class="font-medium">${invoice.customer}</p>
                <p class="text-slate-600">${customer.email}</p>
              </div>
              <div class="text-right">
                <p class="text-slate-500">Invoice Date: <span class="text-slate-900 font-medium">${formatDate(invoice.invoiceDate)}</span></p>
                <p class="text-slate-500">Due Date: <span class="text-slate-900 font-medium">${formatDate(invoice.dueDate)}</span></p>
              </div>
            </div>
            
            <!-- Items Table -->
            <table class="w-full text-xs mb-6">
              <thead>
                <tr class="border-b-2 border-slate-200">
                  <th class="py-2 text-left font-medium text-slate-600">Description</th>
                  <th class="py-2 text-right font-medium text-slate-600">Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-slate-100">
                  <td class="py-3">${invoice.description}</td>
                  <td class="py-3 text-right">₹${invoice.amount.toLocaleString('en-IN')}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr class="border-t-2 border-slate-200">
                  <td class="py-2 font-medium">Total Amount</td>
                  <td class="py-2 text-right font-bold text-lg">₹${invoice.amount.toLocaleString('en-IN')}</td>
                </tr>
                <tr>
                  <td class="py-1 text-green-600">Amount Paid</td>
                  <td class="py-1 text-right text-green-600">₹${invoice.paid.toLocaleString('en-IN')}</td>
                </tr>
                <tr class="bg-slate-50">
                  <td class="py-2 font-bold text-red-600">Balance Due</td>
                  <td class="py-2 text-right font-bold text-red-600">₹${(invoice.amount - invoice.paid).toLocaleString('en-IN')}</td>
                </tr>
              </tfoot>
            </table>
            
            <!-- Footer -->
            <div class="text-center text-[10px] text-slate-400 border-t border-slate-100 pt-4">
              <p>Thank you for your business!</p>
              <p>For questions about this invoice, please contact billing@recordrx.com</p>
            </div>
          </div>
        `;
        
        openModal('invoiceModal');
      }

      function downloadInvoice() {
        if (!currentInvoiceInvoice) return;
        downloadInvoiceForInvoice(currentInvoiceInvoice.id);
      }

      function downloadInvoiceForInvoice(invoiceId) {
        const invoice = invoices.find(b => b.id === invoiceId);
        if (!invoice) return;
        
        // Generate plain text invoice for download
        const customer = customers.find(c => c.id === invoice.customerId) || { email: 'customer@example.com' };
        const balance = invoice.amount - invoice.paid;
        
        const invoiceText = `
RECORD RX - INVOICE
====================================

Invoice Number: ${invoice.id}
Invoice Date: ${formatDate(invoice.invoiceDate)}
Due Date: ${formatDate(invoice.dueDate)}

INVOICE TO:
${invoice.customer}
${customer.email}

------------------------------------
DESCRIPTION                  AMOUNT
------------------------------------
${invoice.description.padEnd(25)} ₹${invoice.amount.toLocaleString('en-IN')}
------------------------------------

Total Amount:     ₹${invoice.amount.toLocaleString('en-IN')}
Amount Paid:      ₹${invoice.paid.toLocaleString('en-IN')}
Balance Due:      ₹${balance.toLocaleString('en-IN')}

====================================
Thank you for your business!
For questions: billing@recordrx.com
        `.trim();
        
        // Create and download file
        const blob = new Blob([invoiceText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${invoice.id}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Initialize invoicing on page load
      document.addEventListener('DOMContentLoaded', () => {
        initDashboard();
        initInvoicing();
        initCustomers();
        initCustomerMgmt();
        initUserMgmt();
      });

      // Also initialize when switching to invoicing page
      const originalShowPage = showPage;
      showPage = function(pageId) {
        originalShowPage(pageId);
        if (pageId === 'dashboard') {
          initDashboard();
        }
        if (pageId === 'invoicing') {
          initInvoicing();
        }
        if (pageId === 'customers') {
          renderCustomersTable();
        }
        if (pageId === 'customer-mgmt') {
          initCustomerMgmt();
        }
        if (pageId === 'user-mgmt') {
          initUserMgmt();
        }
      };

      // ===== DASHBOARD =====
      
      function initDashboard() {
        updateDashboardStats();
        renderRevenueChart();
        renderInvoicingDonut();
        renderQuickInsights();
      }

      function updateDashboardStats() {
        // Customer count
        document.getElementById('dashCustomerCount').textContent = customers.length;
        
        // Revenue (collected)
        const revenue = invoices.filter(b => b.status === 'paid').reduce((sum, b) => sum + b.amount, 0);
        document.getElementById('dashRevenue').textContent = '₹' + revenue.toLocaleString('en-IN');
        
        // Invoice count
        document.getElementById('dashInvoiceCount').textContent = invoices.length;
        
        // Pending invoices badge
        const pendingCount = invoices.filter(b => b.status === 'pending').length;
        document.getElementById('dashPendingBadge').textContent = pendingCount + ' pending';
        
        // Outstanding
        const outstanding = invoices.reduce((sum, b) => sum + (b.amount - b.paid), 0);
        document.getElementById('dashOutstanding').textContent = '₹' + outstanding.toLocaleString('en-IN');
        
        // Overdue badge
        const overdueCount = invoices.filter(b => b.status === 'overdue').length;
        document.getElementById('dashOverdueBadge').textContent = overdueCount + ' overdue';
      }

      function renderRevenueChart() {
        const chart = document.getElementById('revenueChart');
        const labels = document.getElementById('revenueChartLabels');
        if (!chart || !labels) return;

        const months = [];
        const now = new Date();
        for (let i = 5; i >= 0; i--) {
          const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
          months.push({
            key: d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0'),
            label: d.toLocaleString('default', { month: 'short' })
          });
        }

        const monthRevenue = months.map(m => {
          return invoices
            .filter(b => b.status === 'paid' && b.date && b.date.startsWith(m.key))
            .reduce((sum, b) => sum + b.amount, 0);
        });

        const maxVal = Math.max(...monthRevenue, 1);

        chart.innerHTML = months.map((m, i) => {
          const pct = (monthRevenue[i] / maxVal) * 100;
          const val = monthRevenue[i] >= 1000 ? '₹' + (monthRevenue[i] / 1000).toFixed(1) + 'k' : '₹' + monthRevenue[i];
          return `
            <div class="flex-1 flex flex-col items-center justify-end h-full">
              <span class="text-[9px] text-slate-500 mb-1">${val}</span>
              <div class="w-full rounded-t-md bg-gradient-to-t from-teal-600 to-teal-400 transition-all duration-700" style="height: ${Math.max(pct, 4)}%"></div>
            </div>`;
        }).join('');

        labels.innerHTML = months.map(m => 
          `<div class="flex-1 text-center text-[10px] text-slate-500">${m.label}</div>`
        ).join('');
      }

      function renderInvoicingDonut() {
        const totalInvoices = invoices.length;
        const paid = invoices.filter(b => b.status === 'paid').length;
        const pending = invoices.filter(b => b.status === 'pending' || b.status === 'partial').length;
        const overdue = invoices.filter(b => b.status === 'overdue').length;

        const circumference = 2 * Math.PI * 15.915; // ~100

        let paidPct = totalInvoices ? (paid / totalInvoices) * 100 : 0;
        let pendingPct = totalInvoices ? (pending / totalInvoices) * 100 : 0;
        let overduePct = totalInvoices ? (overdue / totalInvoices) * 100 : 0;

        const donutPaid = document.getElementById('donutPaid');
        const donutPending = document.getElementById('donutPending');
        const donutOverdue = document.getElementById('donutOverdue');

        if (donutPaid) {
          donutPaid.setAttribute('stroke-dasharray', paidPct + ' ' + (100 - paidPct));
          donutPaid.setAttribute('stroke-dashoffset', '0');
        }
        if (donutPending) {
          donutPending.setAttribute('stroke-dasharray', pendingPct + ' ' + (100 - pendingPct));
          donutPending.setAttribute('stroke-dashoffset', '-' + paidPct);
        }
        if (donutOverdue) {
          donutOverdue.setAttribute('stroke-dasharray', overduePct + ' ' + (100 - overduePct));
          donutOverdue.setAttribute('stroke-dashoffset', '-' + (paidPct + pendingPct));
        }

        const donutTotal = document.getElementById('donutTotal');
        if (donutTotal) donutTotal.textContent = totalInvoices;

        const legendPaid = document.getElementById('legendPaid');
        const legendPending = document.getElementById('legendPending');
        const legendOverdue = document.getElementById('legendOverdue');
        if (legendPaid) legendPaid.textContent = paid + ' invoices';
        if (legendPending) legendPending.textContent = pending + ' invoices';
        if (legendOverdue) legendOverdue.textContent = overdue + ' invoices';
      }

      function renderQuickInsights() {
        // Collection Rate
        const totalInvoiced = invoices.reduce((sum, b) => sum + b.amount, 0);
        const totalCollected = invoices.filter(b => b.status === 'paid').reduce((sum, b) => sum + b.amount, 0);
        const rate = totalInvoiced > 0 ? Math.round((totalCollected / totalInvoiced) * 100) : 0;
        
        const collectionRate = document.getElementById('collectionRate');
        const collectionBar = document.getElementById('collectionBar');
        if (collectionRate) collectionRate.textContent = rate + '%';
        if (collectionBar) collectionBar.style.width = rate + '%';

        // Active Plans
        const activePlansCount = document.getElementById('activePlansCount');
        const monthlyPlans = plans.filter(p => p.invoicing === 'Monthly').length;
        const yearlyPlans = plans.filter(p => p.invoicing === 'Yearly').length;
        const totalPlans = monthlyPlans + yearlyPlans;
        if (activePlansCount) activePlansCount.textContent = totalPlans;

        const monthlyBar = document.getElementById('monthlyBar');
        const yearlyBar = document.getElementById('yearlyBar');
        if (totalPlans > 0) {
          const mPct = (monthlyPlans / totalPlans) * 100;
          if (monthlyBar) monthlyBar.style.width = mPct + '%';
          if (yearlyBar) yearlyBar.style.width = (100 - mPct) + '%';
        } else {
          if (monthlyBar) monthlyBar.style.width = '50%';
          if (yearlyBar) yearlyBar.style.width = '50%';
        }

        // Open Tickets
        const pendingTickets = tickets.filter(t => t.status === 'pending').length;
        const progressTickets = tickets.filter(t => t.status === 'in-progress').length;
        const openCount = pendingTickets + progressTickets;

        const openTicketsCount = document.getElementById('openTicketsCount');
        const ticketPendingBadge = document.getElementById('ticketPendingBadge');
        const ticketProgressBadge = document.getElementById('ticketProgressBadge');
        if (openTicketsCount) openTicketsCount.textContent = openCount;
        if (ticketPendingBadge) ticketPendingBadge.textContent = pendingTickets + ' pending';
        if (ticketProgressBadge) ticketProgressBadge.textContent = progressTickets + ' in progress';
      }

      function renderRecentInvoices() {
        const container = document.getElementById('recentInvoicesList');
        if (!container) return;
        
        const recentInvoices = invoices.slice(0, 5);
        
        container.innerHTML = recentInvoices.map(invoice => {
          const statusColors = {
            paid: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
            pending: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
            partial: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
            overdue: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'
          };
          
          const iconColors = {
            paid: 'bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400',
            pending: 'bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400',
            partial: 'bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400',
            overdue: 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400'
          };
          
          return `
            <div class="px-4 py-2.5 flex items-center gap-3 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer" onclick="showPage('invoicing')">
              <div class="w-7 h-7 rounded-full ${iconColors[invoice.status]} flex items-center justify-center">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium">${invoice.id}</p>
                <p class="text-xs text-slate-500 dark:text-slate-400 truncate">${invoice.customer} - ₹${invoice.amount.toLocaleString('en-IN')}</p>
              </div>
              <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusColors[invoice.status]}">${invoice.status.toUpperCase()}</span>
            </div>
          `;
        }).join('');
      }

      // ===== CUSTOMERS SYSTEM =====
      
      function initCustomers() {
        renderCustomersTable();
      }

      function renderCustomersTable(filteredCustomers = customers) {
        const tbody = document.getElementById('customersTableBody');
        if (!tbody) return;
        
        const planColors = {
          Basic: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
          Premium: 'bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-400',
          Enterprise: 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400'
        };
        
        tbody.innerHTML = filteredCustomers.map(customer => {
          const customerInvoices = invoices.filter(b => b.customerId === customer.id);
          const pendingInvoices = customerInvoices.filter(b => b.status === 'pending' || b.status === 'partial' || b.status === 'overdue');
          const status = pendingInvoices.length > 0 ? 'Has dues' : 'Clear';
          const statusColor = pendingInvoices.length > 0 
            ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' 
            : 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400';
          
          return `
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
              <td class="px-3 py-2 font-medium text-teal-600 dark:text-teal-400">${customer.id}</td>
              <td class="px-3 py-2">
                <p class="font-medium text-slate-900 dark:text-white">${customer.name}</p>
              </td>
              <td class="px-3 py-2 text-slate-600 dark:text-slate-400">${customer.email}</td>
              <td class="px-3 py-2">
                <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${planColors[customer.plan]}">${customer.plan}</span>
              </td>
              <td class="px-3 py-2 text-right font-medium text-slate-900 dark:text-white">₹${customer.amount.toLocaleString('en-IN')}/mo</td>
              <td class="px-3 py-2 text-center">
                <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusColor}">${status}</span>
              </td>
              <td class="px-3 py-2 text-center">
                <div class="flex items-center justify-center gap-1">
                  <button onclick="viewCustomerInvoices('${customer.id}')" class="p-1 text-slate-400 hover:text-teal-600 dark:hover:text-teal-400" title="View Invoices">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }

      function filterCustomers() {
        const search = document.getElementById('customerSearch').value.toLowerCase();
        
        const filtered = customers.filter(c => {
          return !search || 
            c.name.toLowerCase().includes(search) || 
            c.email.toLowerCase().includes(search) ||
            c.id.toLowerCase().includes(search);
        });
        
        renderCustomersTable(filtered);
      }

      function openAddCustomerModal() {
        document.getElementById('newCustomerName').value = '';
        document.getElementById('newCustomerEmail').value = '';
        document.getElementById('newCustomerPlan').value = 'Basic';
        openModal('addCustomerModal');
      }

      function addCustomer() {
        const name = document.getElementById('newCustomerName').value.trim();
        const email = document.getElementById('newCustomerEmail').value.trim();
        const planSelect = document.getElementById('newCustomerPlan');
        const plan = planSelect.value;
        const amount = parseInt(planSelect.options[planSelect.selectedIndex].dataset.amount);
        
        if (!name || !email) {
          showToast('Please fill in all fields', 'warning');
          return;
        }
        
        const newCustomer = {
          id: `CUST${String(customers.length + 1).padStart(3, '0')}`,
          name,
          email,
          plan,
          amount
        };
        
        customers.push(newCustomer);
        saveAppData();
        renderCustomersTable();
        populateCustomerDropdown();
        closeModal('addCustomerModal');
      }

      function viewCustomerInvoices(customerId) {
        // Navigate to invoicing page with filter
        showPage('invoicing');
        window.location.hash = 'invoicing';
        
        // Filter invoices by customer
        const customerInvoices = invoices.filter(b => b.customerId === customerId);
        renderInvoicesTable(customerInvoices);
        
        // Update search field to show which customer
        const customer = customers.find(c => c.id === customerId);
        if (customer) {
          document.getElementById('invoiceSearch').value = customer.name;
        }
      }

      function generateInvoiceForCustomer(customerId) {
        const customer = customers.find(c => c.id === customerId);
        if (!customer) return;
        
        const today = new Date();
        const dueDate = new Date(Date.now() + 15 * 24 * 60 * 60 * 1000);
        
        const newInvoice = {
          id: `INV-${today.getFullYear()}-${String(invoices.length + 1).padStart(3, '0')}`,
          customerId: customer.id,
          customer: customer.name,
          description: `${customer.plan} Plan - ${today.toLocaleString('default', { month: 'long' })}`,
          invoiceDate: today.toISOString().split('T')[0],
          dueDate: dueDate.toISOString().split('T')[0],
          amount: customer.amount,
          paid: 0,
          status: 'pending'
        };
        
        invoices.unshift(newInvoice);
        renderInvoicesTable();
        updateInvoicingSummary();
        renderCustomersTable();
        
        showToast(`Invoice ${newInvoice.id} generated for ${customer.name}`, 'success');
      }

      // ===== CUSTOMER MANAGEMENT =====
      
      let mgmtCustomers = savedData?.mgmtCustomers || [];

      function initCustomerMgmt() {
        renderMgmtCustomersTable();
      }

      function renderMgmtCustomersTable() {
        const tbody = document.getElementById('mgmtCustomersTableBody');
        if (!tbody) return;
        
        const statusColors = {
          active: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
          inactive: 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400',
          pending: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400'
        };
        
        tbody.innerHTML = mgmtCustomers.map(customer => `
          <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
            <td class="px-3 py-2 font-medium text-teal-600 dark:text-teal-400">${customer.id}</td>
            <td class="px-3 py-2 font-medium text-slate-900 dark:text-white">${customer.name}</td>
            <td class="px-3 py-2 text-slate-600 dark:text-slate-400">${customer.email}</td>
            <td class="px-3 py-2 text-slate-600 dark:text-slate-400">${customer.phone}</td>
            <td class="px-3 py-2 text-slate-600 dark:text-slate-400">${customer.company}</td>
            <td class="px-3 py-2 text-center">
              <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusColors[customer.status]}">${customer.status.toUpperCase()}</span>
            </td>
            <td class="px-3 py-2 text-center">
              <div class="flex items-center justify-center gap-1">
                <button onclick="editMgmtCustomer('${customer.id}')" class="p-1 text-slate-400 hover:text-teal-600 dark:hover:text-teal-400" title="Edit">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button onclick="deleteMgmtCustomer('${customer.id}')" class="p-1 text-slate-400 hover:text-red-600 dark:hover:text-red-400" title="Delete">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        `).join('');
      }

      function openAddMgmtCustomerModal() {
        document.getElementById('mgmtCustomerName').value = '';
        document.getElementById('mgmtCustomerEmail').value = '';
        document.getElementById('mgmtCustomerPhone').value = '';
        document.getElementById('mgmtCustomerCompany').value = '';
        document.getElementById('mgmtCustomerStatus').value = 'active';
        openModal('addMgmtCustomerModal');
      }

      function addMgmtCustomer() {
        const name = document.getElementById('mgmtCustomerName').value.trim();
        const email = document.getElementById('mgmtCustomerEmail').value.trim();
        const phone = document.getElementById('mgmtCustomerPhone').value.trim();
        const company = document.getElementById('mgmtCustomerCompany').value.trim();
        const status = document.getElementById('mgmtCustomerStatus').value;
        
        if (!name || !email) {
          showToast('Please fill in name and email', 'warning');
          return;
        }
        
        const newCustomer = {
          id: `MCUST${String(mgmtCustomers.length + 1).padStart(3, '0')}`,
          name,
          email,
          phone,
          company,
          status
        };
        
        mgmtCustomers.push(newCustomer);
        renderMgmtCustomersTable();
        closeModal('addMgmtCustomerModal');
      }

      function editMgmtCustomer(customerId) {
        const customer = mgmtCustomers.find(c => c.id === customerId);
        if (!customer) return;
        
        const newName = prompt('Customer Name:', customer.name);
        if (newName !== null) {
          customer.name = newName;
          renderMgmtCustomersTable();
        }
      }

      async function deleteMgmtCustomer(customerId) {
        const ok = await showConfirm('Are you sure you want to delete this customer?', 'Delete Customer');
        if (ok) {
          mgmtCustomers = mgmtCustomers.filter(c => c.id !== customerId);
          saveAppData();
          renderMgmtCustomersTable();
          showToast('Customer deleted successfully', 'success');
        }
      }

      // ===== USER MANAGEMENT =====
      
      let users = savedData?.users || [];

      function initUserMgmt() {
        renderUsersTable();
      }

      function renderUsersTable() {
        const tbody = document.getElementById('usersTableBody');
        if (!tbody) return;
        
        const statusColors = {
          active: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
          inactive: 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400'
        };
        
        const roleColors = {
          admin: 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400',
          manager: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
          staff: 'bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-400',
          viewer: 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400'
        };
        
        tbody.innerHTML = users.map(user => `
          <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
            <td class="px-3 py-2 font-medium text-teal-600 dark:text-teal-400">${user.id}</td>
            <td class="px-3 py-2 font-medium text-slate-900 dark:text-white">${user.name}</td>
            <td class="px-3 py-2 text-slate-600 dark:text-slate-400">${user.email}</td>
            <td class="px-3 py-2">
              <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${roleColors[user.role]}">${user.role.toUpperCase()}</span>
            </td>
            <td class="px-3 py-2 text-center">
              <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusColors[user.status]}">${user.status.toUpperCase()}</span>
            </td>
            <td class="px-3 py-2 text-center">
              <div class="flex items-center justify-center gap-1">
                <button onclick="editUser('${user.id}')" class="p-1 text-slate-400 hover:text-teal-600 dark:hover:text-teal-400" title="Edit">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button onclick="deleteUser('${user.id}')" class="p-1 text-slate-400 hover:text-red-600 dark:hover:text-red-400" title="Delete">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        `).join('');
      }

      function openAddUserModal() {
        document.getElementById('newUserName').value = '';
        document.getElementById('newUserEmpId').value = '';
        document.getElementById('newUserEmail').value = '';
        document.getElementById('newUserRole').value = 'staff';
        openModal('addUserModal');
      }

      function generateDefaultPassword() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$!';
        let password = '';
        for (let i = 0; i < 10; i++) {
          password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return password;
      }

      function sendWelcomeEmail(email, name, password, type) {
        // Call backend API to send email via configured SMTP (Gmail)
        const API_BASE = 'http://localhost:3000/api';
        
        fetch(`${API_BASE}/email/welcome`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ to: email, name, password, type })
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            showToast(`Welcome email sent to ${email}`, 'success');
          } else {
            showToast(`Email queued for ${email} (server offline)`, 'info');
          }
        })
        .catch(() => {
          // Server not running - just show notification
          showToast(`Welcome email queued for ${email}`, 'info');
          console.log(`[EMAIL QUEUED] To: ${email}, Subject: Welcome to Radix - Your ${type} Account`);
        });
      }

      function addUser() {
        const name = document.getElementById('newUserName').value.trim();
        const empId = document.getElementById('newUserEmpId').value.trim();
        const email = document.getElementById('newUserEmail').value.trim();
        const role = document.getElementById('newUserRole').value;
        
        if (!name || !empId || !email) {
          showToast('Please fill in all required fields', 'warning');
          return;
        }
        
        const defaultPassword = generateDefaultPassword();
        
        const newUser = {
          id: `USR${String(users.length + 1).padStart(3, '0')}`,
          empId,
          name,
          email,
          role,
          status: 'active'
        };
        
        users.push(newUser);
        saveAppData();
        renderUsersTable();
        closeModal('addUserModal');
        
        // Send welcome email
        sendWelcomeEmail(email, name, defaultPassword, 'Employee');
      }

      function editUser(userId) {
        const user = users.find(u => u.id === userId);
        if (!user) return;
        
        document.getElementById('editUserId').value = user.id;
        document.getElementById('editUserName').value = user.name;
        document.getElementById('editUserEmpId').value = user.empId || user.id;
        document.getElementById('editUserEmail').value = user.email;
        document.getElementById('editUserRole').value = user.role;
        
        openModal('editUserModal');
      }

      function saveUserEdit() {
        const userId = document.getElementById('editUserId').value;
        const user = users.find(u => u.id === userId);
        if (!user) return;
        
        user.name = document.getElementById('editUserName').value.trim();
        user.empId = document.getElementById('editUserEmpId').value.trim();
        user.email = document.getElementById('editUserEmail').value.trim();
        user.role = document.getElementById('editUserRole').value;
        
        saveAppData();
        renderUsersTable();
        closeModal('editUserModal');
      }

      async function deleteUser(userId) {
        const ok = await showConfirm('Are you sure you want to delete this employee?', 'Delete Employee');
        if (ok) {
          users = users.filter(u => u.id !== userId);
          saveAppData();
          renderUsersTable();
          showToast('Employee deleted successfully', 'success');
        }
      }

      // Update editMgmtCustomer to use modal
      function editMgmtCustomer(customerId) {
        const customer = mgmtCustomers.find(c => c.id === customerId);
        if (!customer) return;
        
        document.getElementById('editMgmtCustomerId').value = customer.id;
        document.getElementById('editMgmtCustomerName').value = customer.name;
        document.getElementById('editMgmtCustomerEmail').value = customer.email;
        document.getElementById('editMgmtCustomerPhone').value = customer.phone;
        document.getElementById('editMgmtCustomerCompany').value = customer.company;
        document.getElementById('editMgmtCustomerStatus').value = customer.status;
        
        openModal('editMgmtCustomerModal');
      }

      function saveCustomerEdit() {
        const customerId = document.getElementById('editMgmtCustomerId').value;
        const customer = mgmtCustomers.find(c => c.id === customerId);
        if (!customer) return;
        
        customer.name = document.getElementById('editMgmtCustomerName').value.trim();
        customer.email = document.getElementById('editMgmtCustomerEmail').value.trim();
        customer.phone = document.getElementById('editMgmtCustomerPhone').value.trim();
        customer.company = document.getElementById('editMgmtCustomerCompany').value.trim();
        customer.status = document.getElementById('editMgmtCustomerStatus').value;
        
        saveAppData();
        renderMgmtCustomersTable();
        closeModal('editMgmtCustomerModal');
      }

      // Override addMgmtCustomer to send email
      const originalAddMgmtCustomer = addMgmtCustomer;
      addMgmtCustomer = function() {
        const name = document.getElementById('mgmtCustomerName').value.trim();
        const email = document.getElementById('mgmtCustomerEmail').value.trim();
        const phone = document.getElementById('mgmtCustomerPhone').value.trim();
        const company = document.getElementById('mgmtCustomerCompany').value.trim();
        const status = document.getElementById('mgmtCustomerStatus').value;
        
        if (!name || !email) {
          showToast('Please fill in name and email', 'warning');
          return;
        }
        
        const defaultPassword = generateDefaultPassword();
        
        const newCustomer = {
          id: `MCUST${String(mgmtCustomers.length + 1).padStart(3, '0')}`,
          name,
          email,
          phone,
          company,
          status
        };
        
        mgmtCustomers.push(newCustomer);
        saveAppData();
        renderMgmtCustomersTable();
        closeModal('addMgmtCustomerModal');
        
        // Send welcome email
        sendWelcomeEmail(email, name, defaultPassword, 'Customer');
      };

      // ===== PLAN MANAGEMENT =====

      function initPlanMgmt() {
        renderPlansTable();
        renderOffersTable();
      }

      function renderPlansTable() {
        const tbody = document.getElementById('plansTableBody');
        if (!tbody) return;

        const statusColors = {
          active: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
          inactive: 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400'
        };

        const typeColors = {
          monthly: 'bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-400',
          yearly: 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400'
        };

        tbody.innerHTML = plans.map(plan => `
          <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
            <td class="px-3 py-2 font-medium text-slate-900 dark:text-white">${plan.name}</td>
            <td class="px-3 py-2">
              <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${typeColors[plan.type]}">${plan.type.toUpperCase()}</span>
            </td>
            <td class="px-3 py-2 text-right font-medium text-slate-900 dark:text-white">₹${plan.amount.toLocaleString('en-IN')}</td>
            <td class="px-3 py-2 text-center">
              <span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusColors[plan.status]}">${plan.status.toUpperCase()}</span>
            </td>
            <td class="px-3 py-2 text-center">
              <div class="flex items-center justify-center gap-1">
                <button onclick="editPlan('${plan.id}')" class="p-1 text-slate-400 hover:text-teal-600 dark:hover:text-teal-400" title="Edit">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button onclick="deletePlan('${plan.id}')" class="p-1 text-slate-400 hover:text-red-600 dark:hover:text-red-400" title="Delete">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        `).join('');
      }

      function openAddPlanModal() {
        document.getElementById('newPlanName').value = '';
        document.getElementById('newPlanAmount').value = '';
        document.getElementById('newPlanType').value = 'monthly';
        openModal('addPlanModal');
      }

      function addPlan() {
        const name = document.getElementById('newPlanName').value.trim();
        const amount = parseFloat(document.getElementById('newPlanAmount').value);
        const type = document.getElementById('newPlanType').value;

        if (!name || !amount) {
          showToast('Please fill in all required fields', 'warning');
          return;
        }

        const newPlan = {
          id: `PLAN${String(plans.length + 1).padStart(3, '0')}`,
          name,
          amount,
          type,
          status: 'active'
        };

        plans.push(newPlan);
        saveAppData();
        renderPlansTable();
        closeModal('addPlanModal');
      }

      function editPlan(planId) {
        const plan = plans.find(p => p.id === planId);
        if (!plan) return;

        document.getElementById('editPlanId').value = plan.id;
        document.getElementById('editPlanName').value = plan.name;
        document.getElementById('editPlanAmount').value = plan.amount;
        document.getElementById('editPlanType').value = plan.type;
        document.getElementById('editPlanStatus').value = plan.status;

        openModal('editPlanModal');
      }

      function savePlanEdit() {
        const planId = document.getElementById('editPlanId').value;
        const plan = plans.find(p => p.id === planId);
        if (!plan) return;

        plan.name = document.getElementById('editPlanName').value.trim();
        plan.amount = parseFloat(document.getElementById('editPlanAmount').value);
        plan.type = document.getElementById('editPlanType').value;
        plan.status = document.getElementById('editPlanStatus').value;

        saveAppData();
        renderPlansTable();
        closeModal('editPlanModal');
      }

      async function deletePlan(planId) {
        const ok = await showConfirm('Are you sure you want to delete this plan?', 'Delete Plan');
        if (ok) {
          plans = plans.filter(p => p.id !== planId);
          saveAppData();
          renderPlansTable();
          showToast('Plan deleted successfully', 'success');
        }
      }

      // ===== OFFER MANAGEMENT =====

      function openAddOfferModal() {
        populateOfferPlanDropdown('offerPlan');
        document.getElementById('offerName').value = '';
        document.getElementById('offerDiscount').value = '';
        document.getElementById('offerPlan').value = '';
        document.getElementById('offerStartDate').value = '';
        document.getElementById('offerEndDate').value = '';
        delete offerCalState['offerStartDate'];
        delete offerCalState['offerEndDate'];
        openModal('addOfferModal');
      }

      function populateOfferPlanDropdown(selectId) {
        const select = document.getElementById(selectId);
        select.innerHTML = '<option value="">-- Select a Plan --</option>';
        plans.filter(p => p.status === 'active').forEach(plan => {
          select.innerHTML += `<option value="${plan.id}">${plan.name} (${plan.type === 'monthly' ? 'Monthly' : 'Yearly'} - ₹${plan.amount.toLocaleString()})</option>`;
        });
      }

      function addOffer() {
        const name = document.getElementById('offerName').value.trim();
        const discount = parseInt(document.getElementById('offerDiscount').value);
        const planId = document.getElementById('offerPlan').value;
        const startDate = document.getElementById('offerStartDate').value;
        const endDate = document.getElementById('offerEndDate').value;

        if (!name || !discount || !planId || !startDate || !endDate) {
          showToast('Please fill in all fields', 'warning');
          return;
        }

        if (discount < 1 || discount > 100) {
          showToast('Discount must be between 1 and 100', 'warning');
          return;
        }

        if (new Date(endDate) <= new Date(startDate)) {
          showToast('End date must be after start date', 'warning');
          return;
        }

        const plan = plans.find(p => p.id === planId);

        offers.push({
          id: 'OFF' + String(offers.length + 1).padStart(3, '0'),
          name,
          discount,
          planId,
          planName: plan ? plan.name : 'Unknown',
          startDate,
          endDate,
          status: 'active'
        });

        saveAppData();
        renderOffersTable();
        closeModal('addOfferModal');
      }

      function renderOffersTable() {
        const tbody = document.getElementById('offersTableBody');
        if (!tbody) return;

        if (offers.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="px-3 py-6 text-center text-slate-500 dark:text-slate-400">No offers available. Click "Add Offer" to create one.</td></tr>';
          return;
        }

        const today = new Date().toISOString().split('T')[0];

        tbody.innerHTML = offers.map(offer => {
          const isExpired = offer.endDate < today;
          const statusClass = offer.status === 'active' && !isExpired
            ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400'
            : 'bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400';
          const statusText = isExpired ? 'Expired' : (offer.status === 'active' ? 'Active' : 'Inactive');

          return `
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
              <td class="px-3 py-2 font-medium text-slate-900 dark:text-white">${offer.name}</td>
              <td class="px-3 py-2 text-slate-600 dark:text-slate-300">${offer.planName}</td>
              <td class="px-3 py-2 text-center"><span class="font-semibold text-emerald-600">${offer.discount}%</span></td>
              <td class="px-3 py-2 text-slate-600 dark:text-slate-300">${formatDate(offer.startDate)} - ${formatDate(offer.endDate)}</td>
              <td class="px-3 py-2 text-center"><span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusClass}">${statusText}</span></td>
              <td class="px-3 py-2 text-center">
                <div class="flex items-center justify-center gap-1">
                  <button onclick="editOffer('${offer.id}')" class="p-1 text-slate-400 hover:text-teal-600" title="Edit">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                  </button>
                  <button onclick="deleteOffer('${offer.id}')" class="p-1 text-slate-400 hover:text-red-600" title="Delete">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }

      function editOffer(offerId) {
        const offer = offers.find(o => o.id === offerId);
        if (!offer) return;

        populateOfferPlanDropdown('editOfferPlan');

        document.getElementById('editOfferId').value = offer.id;
        document.getElementById('editOfferName').value = offer.name;
        document.getElementById('editOfferDiscount').value = offer.discount;
        document.getElementById('editOfferPlan').value = offer.planId;
        document.getElementById('editOfferStartDate').value = offer.startDate;
        document.getElementById('editOfferEndDate').value = offer.endDate;
        document.getElementById('editOfferStatus').value = offer.status;
        delete offerCalState['editOfferStartDate'];
        delete offerCalState['editOfferEndDate'];

        openModal('editOfferModal');
      }

      function saveOfferEdit() {
        const offerId = document.getElementById('editOfferId').value;
        const offer = offers.find(o => o.id === offerId);
        if (!offer) return;

        const planId = document.getElementById('editOfferPlan').value;
        const plan = plans.find(p => p.id === planId);

        offer.name = document.getElementById('editOfferName').value.trim();
        offer.discount = parseInt(document.getElementById('editOfferDiscount').value);
        offer.planId = planId;
        offer.planName = plan ? plan.name : 'Unknown';
        offer.startDate = document.getElementById('editOfferStartDate').value;
        offer.endDate = document.getElementById('editOfferEndDate').value;
        offer.status = document.getElementById('editOfferStatus').value;

        saveAppData();
        renderOffersTable();
        closeModal('editOfferModal');
      }

      async function deleteOffer(offerId) {
        const ok = await showConfirm('Are you sure you want to delete this offer?', 'Delete Offer');
        if (ok) {
          offers = offers.filter(o => o.id !== offerId);
          saveAppData();
          renderOffersTable();
          showToast('Offer deleted successfully', 'success');
        }
      }

      // ===== TICKET MANAGEMENT =====

      function openAddTicketModal() {
        populateTicketCustomerDropdown();
        document.getElementById('ticketSubject').value = '';
        document.getElementById('ticketDescription').value = '';
        document.getElementById('ticketPriority').value = 'medium';
        openModal('addTicketModal');
      }

      function populateTicketCustomerDropdown() {
        const select = document.getElementById('ticketCustomer');
        select.innerHTML = '<option value="">-- Select Customer --</option>';
        mgmtCustomers.forEach(cust => {
          select.innerHTML += `<option value="${cust.id}">${cust.name} (${cust.id})</option>`;
        });
      }

      function addTicket() {
        const customerId = document.getElementById('ticketCustomer').value;
        const subject = document.getElementById('ticketSubject').value.trim();
        const description = document.getElementById('ticketDescription').value.trim();
        const priority = document.getElementById('ticketPriority').value;

        if (!customerId || !subject) {
          showToast('Please select a customer and enter a subject', 'warning');
          return;
        }

        const customer = mgmtCustomers.find(c => c.id === customerId);

        tickets.push({
          id: 'TKT' + String(tickets.length + 1).padStart(4, '0'),
          customerId,
          customerName: customer ? customer.name : 'Unknown',
          subject,
          description,
          priority,
          status: 'pending',
          createdAt: new Date().toISOString().split('T')[0]
        });

        saveAppData();
        renderTicketsTable();
        updateTicketStats();
        closeModal('addTicketModal');
      }

      function renderTicketsTable() {
        const tbody = document.getElementById('ticketsTableBody');
        if (!tbody) return;

        if (tickets.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="px-3 py-6 text-center text-slate-500 dark:text-slate-400">No tickets yet. Click "New Ticket" to create one.</td></tr>';
          return;
        }

        tbody.innerHTML = tickets.map(ticket => {
          const statusClasses = {
            pending: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
            'in-progress': 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400',
            closed: 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400'
          };
          const priorityClasses = {
            low: 'text-slate-600 dark:text-slate-400',
            medium: 'text-amber-600 dark:text-amber-400',
            high: 'text-orange-600 dark:text-orange-400',
            urgent: 'text-red-600 dark:text-red-400 font-semibold'
          };

          return `
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
              <td class="px-3 py-2 font-medium text-slate-900 dark:text-white">${ticket.id}</td>
              <td class="px-3 py-2 text-slate-600 dark:text-slate-300">${ticket.customerName}</td>
              <td class="px-3 py-2 text-slate-900 dark:text-white">${ticket.subject}</td>
              <td class="px-3 py-2"><span class="${priorityClasses[ticket.priority]}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)}</span></td>
              <td class="px-3 py-2 text-center"><span class="px-2 py-0.5 text-[10px] font-medium rounded-full ${statusClasses[ticket.status]}">${ticket.status === 'in-progress' ? 'In Progress' : ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1)}</span></td>
              <td class="px-3 py-2 text-slate-600 dark:text-slate-300">${formatDate(ticket.createdAt)}</td>
              <td class="px-3 py-2 text-center">
                <div class="flex items-center justify-center gap-1">
                  <select onchange="updateTicketStatus('${ticket.id}', this.value)" class="text-[10px] px-1 py-0.5 border border-slate-200 dark:border-slate-700 rounded bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200">
                    <option value="pending" ${ticket.status === 'pending' ? 'selected' : ''}>Pending</option>
                    <option value="in-progress" ${ticket.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                    <option value="closed" ${ticket.status === 'closed' ? 'selected' : ''}>Closed</option>
                  </select>
                  <button onclick="deleteTicket('${ticket.id}')" class="p-1 text-slate-400 hover:text-red-600" title="Delete">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }

      function updateTicketStatus(ticketId, newStatus) {
        const ticket = tickets.find(t => t.id === ticketId);
        if (ticket) {
          ticket.status = newStatus;
          saveAppData();
          updateTicketStats();
        }
      }

      async function deleteTicket(ticketId) {
        const ok = await showConfirm('Are you sure you want to delete this ticket?', 'Delete Ticket');
        if (ok) {
          tickets = tickets.filter(t => t.id !== ticketId);
          saveAppData();
          renderTicketsTable();
          updateTicketStats();
          showToast('Ticket deleted successfully', 'success');
        }
      }

      function updateTicketStats() {
        const total = tickets.length;
        const pending = tickets.filter(t => t.status === 'pending').length;
        const inProgress = tickets.filter(t => t.status === 'in-progress').length;
        const closed = tickets.filter(t => t.status === 'closed').length;

        const totalEl = document.getElementById('totalTickets');
        const pendingEl = document.getElementById('pendingTickets');
        const inProgressEl = document.getElementById('inProgressTickets');
        const closedEl = document.getElementById('closedTickets');

        if (totalEl) totalEl.textContent = total;
        if (pendingEl) pendingEl.textContent = pending;
        if (inProgressEl) inProgressEl.textContent = inProgress;
        if (closedEl) closedEl.textContent = closed;
      }

      // ===== CALENDAR DATE PICKER =====

      const datePickerState = {
        dashboard: { startDate: null, endDate: null, currentMonth: new Date() },
        invoicing: { startDate: null, endDate: null, currentMonth: new Date() },
        customers: { startDate: null, endDate: null, currentMonth: new Date() },
        tickets: { startDate: null, endDate: null, currentMonth: new Date() }
      };

      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

      function toggleDatePicker(page, evt) {
        if (evt) evt.stopPropagation();
        const calendar = document.getElementById(`${page}Calendar`);
        if (calendar.classList.contains('hidden')) {
          // Close any other open calendars first
          ['dashboard', 'invoicing', 'customers', 'tickets'].forEach(p => {
            if (p !== page) {
              const other = document.getElementById(`${p}Calendar`);
              if (other) other.classList.add('hidden');
            }
          });
          calendar.classList.remove('hidden');
          renderCalendar(page);
        } else {
          calendar.classList.add('hidden');
        }
      }

      function renderCalendar(page) {
        const state = datePickerState[page];
        const currentMonth = new Date(state.currentMonth);
        const nextMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);

        // Update month labels
        document.getElementById(`${page}Month0`).textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
        document.getElementById(`${page}Month1`).textContent = `${monthNames[nextMonth.getMonth()]} ${nextMonth.getFullYear()}`;

        // Render days for both months
        renderMonthDays(page, 0, currentMonth);
        renderMonthDays(page, 1, nextMonth);
      }

      function renderMonthDays(page, monthIndex, date) {
        const container = document.getElementById(`${page}Days${monthIndex}`);
        const state = datePickerState[page];
        const year = date.getFullYear();
        const month = date.getMonth();
        const today = new Date();

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();

        let html = '';

        // Previous month days
        for (let i = firstDay - 1; i >= 0; i--) {
          const day = daysInPrevMonth - i;
          html += `<div class="calendar-day other-month">${day}</div>`;
        }

        // Current month days
        for (let day = 1; day <= daysInMonth; day++) {
          const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
          const isSelected = state.startDate === dateStr || state.endDate === dateStr;
          const isInRange = state.startDate && state.endDate && dateStr > state.startDate && dateStr < state.endDate;
          const isRangeStart = state.startDate === dateStr;
          const isRangeEnd = state.endDate === dateStr;

          let classes = 'calendar-day';
          if (isToday) classes += ' today';
          if (isSelected) classes += ' selected';
          if (isInRange) classes += ' in-range';
          if (isRangeStart) classes += ' range-start';
          if (isRangeEnd) classes += ' range-end';

          html += `<div class="${classes}" data-page="${page}" data-date="${dateStr}">${day}</div>`;
        }

        // Next month days
        const totalCells = firstDay + daysInMonth;
        const remainingCells = (7 - (totalCells % 7)) % 7;
        for (let day = 1; day <= remainingCells; day++) {
          html += `<div class="calendar-day other-month">${day}</div>`;
        }

        container.innerHTML = html;

        // Attach click events using delegation to prevent event issues
        container.querySelectorAll('.calendar-day:not(.other-month)').forEach(dayEl => {
          dayEl.addEventListener('click', function(e) {
            e.stopPropagation();
            const pg = this.getAttribute('data-page');
            const dt = this.getAttribute('data-date');
            if (pg && dt) selectDate(pg, dt);
          });
        });
      }

      function selectDate(page, dateStr) {
        const state = datePickerState[page];

        if (!state.startDate || (state.startDate && state.endDate)) {
          // Starting fresh selection
          state.startDate = dateStr;
          state.endDate = null;
        } else if (dateStr < state.startDate) {
          // Selected date is before start, swap them
          state.endDate = state.startDate;
          state.startDate = dateStr;
        } else {
          // Selected date is after start, set as end
          state.endDate = dateStr;
        }

        renderCalendar(page);
        updateDateDisplay(page);
      }

      function prevMonth(page, monthIndex) {
        const state = datePickerState[page];
        state.currentMonth = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth() - 1, 1);
        renderCalendar(page);
      }

      function nextMonth(page, monthIndex) {
        const state = datePickerState[page];
        state.currentMonth = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth() + 1, 1);
        renderCalendar(page);
      }

      function updateDateDisplay(page) {
        const state = datePickerState[page];
        const display = document.getElementById(`${page}DateDisplay`);

        if (state.startDate && state.endDate) {
          const start = new Date(state.startDate);
          const end = new Date(state.endDate);
          display.textContent = `${monthNames[start.getMonth()].slice(0, 3)} ${start.getDate()}, ${start.getFullYear()} - ${monthNames[end.getMonth()].slice(0, 3)} ${end.getDate()}, ${end.getFullYear()}`;
        } else if (state.startDate) {
          const start = new Date(state.startDate);
          display.textContent = `${monthNames[start.getMonth()].slice(0, 3)} ${start.getDate()}, ${start.getFullYear()} - Select end`;
        } else {
          display.textContent = 'Select Date Range';
        }
      }

      function clearDateRange(page) {
        datePickerState[page].startDate = null;
        datePickerState[page].endDate = null;
        renderCalendar(page);
        updateDateDisplay(page);
      }

      function applyDateRange(page) {
        const state = datePickerState[page];
        if (state.startDate && state.endDate) {
          console.log(`${page} filtered: ${state.startDate} to ${state.endDate}`);
          document.getElementById(`${page}Calendar`).classList.add('hidden');
        } else {
          showToast('Please select both start and end dates', 'warning');
        }
      }

      // Close calendar when clicking outside - but not when clicking inside the calendar
      document.addEventListener('click', (e) => {
        ['dashboard', 'invoicing', 'customers', 'tickets'].forEach(page => {
          const picker = document.getElementById(`${page}DatePicker`);
          const calendar = document.getElementById(`${page}Calendar`);
          if (picker && calendar && !picker.contains(e.target) && !calendar.contains(e.target)) {
            calendar.classList.add('hidden');
          }
        });
      });

      // ===== SETTINGS FUNCTIONS =====

      // Invoicing Config
      function initInvoicingConfig() {
        const genSelect = document.getElementById('invoiceGenDay');
        const dueSelect = document.getElementById('invoiceDueDay');
        genSelect.innerHTML = '';
        dueSelect.innerHTML = '';
        for (let i = 1; i <= 28; i++) {
          const suffix = i === 1 ? 'st' : i === 2 ? 'nd' : i === 3 ? 'rd' : 'th';
          genSelect.innerHTML += `<option value="${i}">${i}${suffix} of every month</option>`;
          dueSelect.innerHTML += `<option value="${i}">${i}${suffix} of every month</option>`;
        }
        // Load saved values
        const cfg = appData.invoicingConfig || {};
        genSelect.value = cfg.invoiceGenDay || 1;
        dueSelect.value = cfg.invoiceDueDay || 10;
      }

      function saveInvoicingConfig() {
        const genDay = parseInt(document.getElementById('invoiceGenDay').value);
        const dueDay = parseInt(document.getElementById('invoiceDueDay').value);
        if (!appData.invoicingConfig) appData.invoicingConfig = {};
        appData.invoicingConfig.invoiceGenDay = genDay;
        appData.invoicingConfig.invoiceDueDay = dueDay;
        appData.invoicingConfig.emailFrequency = { monthly: 'daily', yearly: 'weekly' };
        saveAppData();
        showToast('Invoicing configuration saved successfully!', 'success');
      }

      initInvoicingConfig();

      function changePassword() {
        const current = document.getElementById('currentPassword').value;
        const newPass = document.getElementById('newPassword').value;
        const confirm = document.getElementById('confirmPassword').value;

        if (!current || !newPass || !confirm) {
          showToast('Please fill in all password fields', 'warning');
          return;
        }

        if (newPass !== confirm) {
          showToast('New passwords do not match', 'error');
          return;
        }

        if (newPass.length < 8) {
          showToast('Password must be at least 8 characters long', 'warning');
          return;
        }

        // In production, this would call backend API
        console.log('Password change requested');
        showToast('Password changed successfully!', 'success');

        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
      }

      // Initialize Plan Management
      if (document.getElementById('page-plan-mgmt')) {
        initPlanMgmt();
      }

      // Initialize Tickets
      if (document.getElementById('page-tickets')) {
        renderTicketsTable();
        updateTicketStats();
      }
    </script>
  </body>
</html>
